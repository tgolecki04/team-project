#| warning: false
NA_count <- colSums(is.na(badania))[colSums(is.na(badania)) > 0] |>
data.frame()
names(NA_count) <- "count"
NA_count$var = rownames(NA_count)
rownames(NA_count) <- NULL
NA_count <- select(NA_count, c(2,1))
p <- ggplot(NA_count, aes(x = var, y = count)) +
geom_col(show.legend = FALSE, fill = "#6AAED9") +
theme_ipsum_rc() +
geom_text(aes(label = count), vjust = -0.5) +
expand_limits(y = max(NA_count$count) * 1.1) +
labs(title = "Liczba wartości NA w zmiennych")
ggsave("images/plots/na_count_before.png", p)
#| label: NA_rows
NA_df <- data.frame(NA_w_wierszu = rowSums(is.na(badania))) |>
group_by(NA_w_wierszu) |>
summarise(liczebnosc = n())
p <- NA_df |> ggplot(aes(NA_w_wierszu, liczebnosc)) +
geom_col(show.legend = FALSE, fill = "#6AAED9") +
theme_ipsum_rc() +
geom_text(aes(label = liczebnosc), vjust = -0.5) +
expand_limits(y = max(NA_df$liczebnosc) * 1.1) +
labs(title = "Liczba wartości NA w rekordach")
ggsave("images/plots/NA_count_perRow.png", p)
badania <- badania[rowSums(is.na(badania)) <= 1, ]
#| warning: false
#| echo: false
NA_count <- colSums(is.na(badania))[colSums(is.na(badania)) > 0] |>
data.frame()
names(NA_count) <- "count"
NA_count$var = rownames(NA_count)
rownames(NA_count) <- NULL
NA_count <- select(NA_count, c(2,1))
p <- ggplot(NA_count, aes(x = var, y = count)) +
geom_col(show.legend = FALSE, fill = "#6AAED9") +
theme_ipsum_rc() +
geom_text(aes(label = count), vjust = -0.5) +
expand_limits(y = max(NA_count$count) * 1.1) +
labs(title = "Liczba wartości NA w zmiennych")
ggsave("images/plots/na_count_after.png", p)
#| output: false
statystyki_przed <- describe(badania[NA_count$var])
metody <- make.method(badania)
metody["BPMeds"] <- "logreg"        #
metody["education"] <- "polr"
metody["BMI"] <- "pmm"
metody["cigsPerDay"] <- "pmm"
metody["glucose"] <- "pmm"
metody["heartRate"] <- "pmm"
metody["totChol"] <- "pmm"
uzupelnienia <- mice(badania,
m = 5,
method = metody,
seed = 2025)
badania <- complete(uzupelnienia)
statystyki_po <- describe(badania[NA_count$var])
round(data.frame(t(statystyki_przed))[c(2:9,10:12), ], 3)
round(data.frame(t(statystyki_po))[c(2:9,10:12), ], 3)
write.csv(badania, file = "badania.csv")
badania <- mutate(badania, ID = 1:nrow(badania))
zdrowi <- badania |>
subset(TenYearCHD == "No")
chorzy <- badania |>
subset(TenYearCHD == "Yes")
#| warning: false
zmienna_wykres <- function(dane, typ_zmiennej, typ_wykresu) {
my_plots = list()
if (typ_zmiennej == "kategoryczna") {
dane <- dane |>
dplyr::select(where(is.factor))
} else if (typ_zmiennej == "numeryczna") {
dane <- dane |>
dplyr::select(where(is.numeric))
} else {
# nic nie robimy
}
for (i in 1:ncol(dane)) {
kolumna <- colnames(dane)[i]
if (typ_wykresu == "barplot") {
p <- ggplot(dane, aes(x = !!sym(kolumna), fill = !!sym(kolumna))) +
geom_bar(show.legend = FALSE, width = 0.6) +
theme_ipsum_rc() +
ggtitle(kolumna) +
scale_fill_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041"))
} else if (typ_wykresu == "pie") {
p <- dane %>%
dplyr::count(!!sym(kolumna)) %>%
ggplot(aes(x = "", y = n, fill = !!sym(kolumna))) +
geom_bar(stat = "identity", width = 1, color = "white") +
coord_polar(theta = "y") +
theme_void() +
ggtitle(kolumna) +
scale_fill_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041"))
} else if (typ_wykresu == "histogram") {
p <- ggplot(dane, aes(x = !!sym(kolumna))) +
geom_histogram(bins = 20, show.legend = FALSE, fill = "#6AAED9", color = "black") +
theme_ipsum_rc() +
ggtitle(kolumna)
} else if (typ_wykresu == "violin") {
p <- ggplot(dane, aes(x = "", y = !!sym(kolumna), fill = "#6AAED9")) +
geom_violin(show.legend = FALSE) +
theme_ipsum_rc() +
ggtitle(kolumna) +
scale_fill_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041"))
} else {
next  # pomiń jeśli nieznany typ wykresu
}
my_plots[[i]] <- p
}
gotowy_wykres_1 <- (my_plots[[1]] + my_plots[[2]]) / (my_plots[[3]] + my_plots[[4]])
gotowy_wykres_2 <- (my_plots[[5]] + my_plots[[6]]) / (my_plots[[7]] + my_plots[[8]])
ggsave(paste0("images/plots/", typ_zmiennej, "_", typ_wykresu, "1.png"), gotowy_wykres_1)
ggsave(paste0("images/plots/", typ_zmiennej, "_", typ_wykresu, "2.png"), gotowy_wykres_2)
}
#| label: Kategoryczne_Wstep
zmienna_wykres(badania, "kategoryczna", "barplot")
zmienna_wykres(badania, "kategoryczna", "pie")
#| label: Numeryczne_Wstep
zmienna_wykres(badania, "numeryczna", "violin")
zmienna_wykres(badania, "numeryczna", "histogram")
#| label: Korelacja
cor_mat <- badania %>%
select(where(is.numeric)) %>%
cor()
p <- ggcorrplot(
cor_mat,
lab = TRUE,
type = "lower",
hc.order = TRUE,          #
outline.col = "white",
ggtheme = ggplot2::theme_minimal(),
colors = c("#6AAED9", "white", "#F25041")
) + ggtitle("Macierz Korelacji")
ggsave("images/plots/korelacja.jpg", p)
#| label: sysBP_wzgledem_diaBP
p1 <- ggplot(badania, aes(x = diaBP, y = sysBP, color = sex, shape = sex)) +
geom_point() +
theme_ipsum_rc() +
ggtitle("sysBP ~ diaBP") +
scale_color_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041")) +
theme(legend.position = "bottom")
ggsave("images/plots/sysBP_wzgledem_diaBP.jpg", p1)
#| label: diaBP
p1 <- ggplot(badania, aes(x = diaBP, color = sex)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
ggtitle("Distribution of diaBP by Sex") +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
theme(legend.position = "bottom")
p2 <- ggplot(badania, aes(x = diaBP, color = education)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
ggtitle("Distribution of diaBP by Education Level") +
scale_color_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041")) +
theme(legend.position = "bottom")
p3 <- ggplot(badania, aes(x = diaBP, color = currentSmoker)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
ggtitle("Distribution of diaBP by Smoking") +
scale_color_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041")) +
theme(legend.position = "bottom")
ggsave("images/plots/diaBP_bySex.jpg", p1)
ggsave("images/plots/diaBP_byEducation.jpg", p2)
ggsave("images/plots/diaBP_byCurrentSmoker.jpg", p3)
#| label: sysBP
p1 <- ggplot(badania, aes(x = sysBP, color = sex)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
ggtitle("Distribution of sysBP by Sex") +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
theme(legend.position = "bottom")
p2 <- ggplot(badania, aes(x = sysBP, color = education)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
ggtitle("Distribution of sysBP by Education Level") +
scale_color_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041")) +
theme(legend.position = "bottom")
p3 <- ggplot(badania, aes(x = sysBP, color = currentSmoker)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
ggtitle("Distribution of sysBP by Smoking") +
scale_color_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041")) +
theme(legend.position = "bottom")
ggsave("images/plots/sysBP_bySex.jpg", p1)
ggsave("images/plots/sysBP_byEducation.jpg", p2)
ggsave("images/plots/sysBP_byCurrentSmoker.jpg", p3)
#| label: Pulse_pressure
#| warning: false
p1 <- badania |>
mutate(range_diff = sysBP - diaBP) |>
arrange(range_diff) |>
ggplot(aes(x = range_diff, color = TenYearCHD)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
labs(title = "Pulse pressure distribution", x = "sysBP - diaBP")
p2 <- badania |>
mutate(range_diff = sysBP - diaBP) |>
arrange(range_diff) |>
ggplot(aes(x = range_diff, color = prevalentHyp)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
labs(title = "Pulse pressure distribution", x = "sysBP - diaBP")
p3 <- badania |>
mutate(range_diff = sysBP - diaBP) |>
arrange(range_diff) |>
ggplot(aes(x = range_diff, color = diabetes)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391", "#2C5DBF", "#F25041")) +
labs(title = "Pulse pressure distribution", x = "sysBP - diaBP")
ggsave("images/plots/pulse_pressure_1.jpg", p1)
ggsave("images/plots/pulse_pressure_2.jpg", p2)
ggsave("images/plots/pulse_pressure_3.jpg", p3)
#| label: Cisnienie_wzgledem_ryzyka
#| warning: false
p1 <- badania |>
ggplot(aes(x = TenYearCHD, y = sysBP, color = sex)) +
geom_boxplot() +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Value of sysBP by Sex")
p2 <- badania |>
ggplot(aes(x = TenYearCHD, y = diaBP, color = sex)) +
geom_boxplot() +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Value of diaBP by Sex")
ggsave("images/plots/cisnienie_wzlgedem_ryzyka_bySex_1.png", p1)
ggsave("images/plots/cisnienie_wzlgedem_ryzyka_bySex_2.png", p2)
#| label: Cisnienie_wzgledem_ryzyka_2
p1 <- badania |>
ggplot(aes(x = TenYearCHD, y = sysBP, color = prevalentHyp)) +
geom_boxplot() +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Value of sysBP by the fact of prevalent Hypothesis")
p2 <- badania |>
ggplot(aes(x = TenYearCHD, y = diaBP, color = prevalentHyp)) +
geom_boxplot() +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Value of diaBP by the fact of prevalent Hypothesis")
ggsave("images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_1.png", p1)
ggsave("images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_2.png", p2)
#| label: rozklad_cisnienia
#| warning: false
p1 <- badania |>
ggplot(aes(x = sysBP, color = TenYearCHD)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Distribution of sysBP including risk of disease")
p2 <- badania |>
ggplot(aes(x = diaBP, color = TenYearCHD)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Distribution of diaBP including risk of disease")
ggsave("images/plots/rozklad_cisnienia_1.png", p1)
ggsave("images/plots/rozklad_cisnienia_2.png", p2)
#| label: poziom_tetna
#| warning: false
bins <- seq(min(badania$heartRate), max(badania$heartRate), length.out = 16)
hist_data <- badania %>%
mutate(bin = cut(heartRate, breaks = bins, include.lowest = TRUE)) %>%
count(TenYearCHD, bin) %>%
mutate(count_adj = ifelse(TenYearCHD == "No", n, -n))
p <- hist_data |>
ggplot(aes(x = bin, y = count_adj, fill = TenYearCHD)) +
geom_col(position = "identity") +
labs(y = "Liczebność w grupie", x = "Przedziały") +
theme_ipsum_rc() +
scale_fill_manual(values = c("#6AAED9", "#F2A391"))
ggsave("images/plots/poziom_tetna.png", p)
#| label: rozklad_tetna_gestosc
#| warning: false
p <- badania |>
ggplot(aes(x = heartRate)) +
geom_density(color = "#6AAED9", lwd = 1.2) +
stat_function(
fun = dnorm,
args = list(mean = mean(badania$heartRate), sd = sd(badania$heartRate)),
linewidth = 1.2,
col = "#F25041"
) +
theme_ipsum_rc()
ggsave("images/plots/rozklad_tetna_gestosc.png", p)
#| label: heartRate_by
#| warning: false
p1 <- badania |>
ggplot(aes(x = TenYearCHD, y = heartRate, color = sex)) +
geom_boxplot() +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("heartRate ~ TenYearCHD")
p2 <- badania |>
ggplot(aes(x = TenYearCHD, y = heartRate, color = currentSmoker)) +
geom_boxplot() +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("heartRate ~ TenYearCHD")
p3 <- badania |>
ggplot(aes(x = TenYearCHD, y = heartRate, color = BPMeds)) +
geom_boxplot() +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("heartRate ~ TenYearCHD")
ggsave("images/plots/heartRate_bySex.png", p1)
ggsave("images/plots/heartRate_bycurrentSmoker.png", p2)
ggsave("images/plots/heartRate_byBPMeds.png", p3)
#| label: leki_nadcisnienie
#| warning: false
p1 <- badania |>
ggplot(aes(x = sysBP, color = BPMeds)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391"))
p2 <- badania |>
ggplot(aes(x = diaBP, color = BPMeds)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391"))
ggsave("images/plots/leki_nadcisnienie_rozklad1.png", p1)
ggsave("images/plots/leki_nadcisnienie_rozklad2.png", p2)
osoby_palace <- badania |>
subset(currentSmoker == "Yes")
osoby_niepalace <- badania |>
subset(cigsPerDay == 0)
data.frame(osoby_palace = nrow(osoby_palace),
osoby_niepalace = nrow(osoby_niepalace),
row.names = "Liczba osób"
)
#| warning: false
p1 <- badania |>
ggplot(aes(x = currentSmoker, fill = currentSmoker)) +
geom_bar(fill = c("#6AAED9", "#F2A391"), width = 0.3, color = "black") +
theme_ipsum_rc() +
ggtitle("Smokers vs No Smokers")
p2 <- badania |>
ggplot(aes(x = currentSmoker, fill = sex)) +
geom_bar(position = position_dodge(width = 0.7), color = "black",  width = 0.6) +
theme_ipsum_rc() +
scale_fill_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Smoking including sex")
p3 <- badania |>
ggplot(aes(x = currentSmoker, fill = TenYearCHD)) +
geom_bar(position = position_dodge(width = 0.7), color = "black",  width = 0.6) +
theme_ipsum_rc() +
scale_fill_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Smoking including potential risk of disease")
ggsave("images/plots/number_of_smokers.png", p1)
ggsave("images/plots/number_of_smokers_bySex.png", p2)
ggsave("images/plots/number_of_smokers_byTenYearCHD.png", p3)
#| label: cigs_per_Day
#| warning: false
p1 <- badania |>
ggplot(aes(x = cigsPerDay)) +
geom_bar(fill = "#6AAED9") +
theme_ipsum_rc()
p2 <- osoby_palace |>
ggplot(aes(x = cigsPerDay)) +
geom_bar(fill = "#6AAED9") +
theme_ipsum_rc()
ggsave("images/plots/cigsPerDay1.png", p1)
ggsave("images/plots/cigsPerDay2.png", p2)
#| label: impact_of_smkoing
#| warning: false
paczki <- badania |>
group_by(cigsPerDay, TenYearCHD) |>
summarise(n = n(), .groups = "drop") |>
group_by(cigsPerDay) |>
mutate(perc = n / sum(n) * 100)
p1 <- paczki[1:28, ] |>
ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +
geom_col(position = position_dodge(width = 0.8)) +
labs(
x = "Cigarettes per Day",
y = "Liczba osób",
fill = "TenYearCHD"
) +
theme_ipsum_rc() +
scale_fill_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Impact of smoking for potential risk")
p2 <- paczki[3:28, ] |>
ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +
geom_col(position = position_dodge(width = 0.8)) +
labs(
x = "Cigarettes per Day",
y = "Liczba osób",
fill = "TenYearCHD"
) +
theme_ipsum_rc() +
scale_fill_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Impact of smoking for potential risk")
p3 <- paczki[29:nrow(paczki), ] |>
ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +
geom_col(position = position_dodge(width = 0.8)) +
labs(
x = "Cigarettes per Day",
y = "Liczba osób",
fill = "TenYearCHD"
) +
theme_ipsum_rc() +
scale_fill_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Impact of smoking for potential risk")
ggsave("images/plots/impact_of_smoking_all.png", p1)
ggsave("images/plots/impact_of_smoking_part1.png", p2)
ggsave("images/plots/impact_of_smoking_part2.png", p3)
#| label: Fraction_of_risk
#| warning: false
paczki_procenty <- badania |>
group_by(cigsPerDay) |>
mutate(cigsSum = n()) |>
subset(cigsSum > 20) |>
group_by(cigsPerDay, TenYearCHD) |>
summarise(n = n(), .groups = "drop") |>
group_by(cigsPerDay) |>
mutate(perc = n / sum(n) * 100)
p1 <- paczki_procenty |>
ggplot(aes(x = factor(cigsPerDay),
y = perc,
fill = factor(TenYearCHD)
)) +
geom_col() +
labs(
x = "Cigarettes per Day",
y = "Procent",
fill = "Ten-Year CHD"
) +
theme_ipsum_rc() +
scale_fill_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Fraction of risk group")
ggsave("images/plots/fraction.png", p1)
#| label: smoking_byAge
#| warning: false
p1 <- badania |>
ggplot(aes(y = age, color = currentSmoker)) +
geom_boxplot(lwd = 0.8) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
theme(axis.text.x = element_blank(),
axis.ticks.x = element_blank()) +
ggtitle("Distribution of age")
p2 <- badania |>
ggplot(aes(x = age, color = currentSmoker)) +
geom_density(lwd = 1.2) +
theme_ipsum_rc() +
scale_color_manual(values = c("#6AAED9", "#F2A391")) +
ggtitle("Distribution of age")
ggsave("images/plots/smoking_byAge_1.png", p1)
ggsave("images/plots/smoking_byAge_2.png", p2)
#| warning: false
paczki_mean <- badania |>
group_by(cigsPerDay) |>
mutate(
cigsSum = n(),
sysBP_mean = mean(sysBP),
diaBP_mean = mean(diaBP)
) |>
subset(cigsSum > 50)
p <- paczki_mean |>
ggplot(aes(x = cigsPerDay)) +
geom_line(aes(y = diaBP_mean), lwd = 1.2, color = "#6AAED9") +
geom_line(aes(y = sysBP_mean), lwd = 1.2, color = "#F2A391") +
theme_ipsum_rc() +
ggtitle("Mean values of sysBP and diaBP including smoking")
ggsave("images/plots/mean_BP.png", p)
#| label: concatenation
#| warning: false
p <- ggVennDiagram(list(
Udar = which(badania$prevalentStroke == "Yes"),
Nadcisnienie = which(badania$prevalentHyp == "Yes"),
Ryzyko = which(badania$TenYearCHD== "Yes")
), set_size = 2.5) +
theme_minimal() +
scale_fill_gradient(low = "#6AAED9", high = "#F2A391") +
theme(legend.position = "none") +
ggtitle("Concatenation of dangerous diseases")
ggsave("images/plots/concatenation.png", p)
str(badania)
logit_model <- glm(TenYearCHD ~ age + sex + education + sysBP + diaBP + heartRate + BMI +
totChol + glucose + diabetes + cigsPerDay + currentSmoker + BPMeds +
prevalentStroke + prevalentHyp,
data = badania,
family = binomial(link = "logit"))
summary(logit_model)
exp(coef(logit_model))
step_model <- step(logit_model, direction = "both")
summary(step_model)
badania$pred_prob <- predict(logit_model, type = "response")
badania$pred_class <- ifelse(badania$pred_prob > 0.2, 1, 0)
badania$pred_class <- factor(badania$pred_class, labels = c("No", "Yes"))
library(pROC)
roc_obj <- roc(badania$TenYearCHD, badania$pred_prob)
plot(roc_obj)
auc(roc_obj)
library(car)
vif(logit_model)
table(Predicted = badania$pred_class, Actual = badania$TenYearCHD)
accuracy <- mean(badania$pred_class == badania$TenYearCHD)
accuracy
badania |>
ggplot(aes(y = sysBP, color = education)) +
geom_boxplot() +
theme_ipsum_rc()
badania |>
ggplot(aes(y = diaBP, color = education)) +
geom_boxplot() +
theme_ipsum_rc()
