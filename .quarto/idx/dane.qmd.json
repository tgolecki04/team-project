{"title":"Wczesne Wykrywanie Ryzyka Zawału Serca","markdown":{"yaml":{"title":"Wczesne Wykrywanie Ryzyka Zawału Serca","subtitle":"Zapoznanie I Praca Z Danymi","format":"html","editor":"visual","warning":false},"headingText":"Rozpoczęcie","containsRefs":false,"markdown":"\n\n\nKoniec z Lorem Ipsum. Test GitHub Desktop.\n\n## Biblioteki\n\n```{r}\n#| output: false\nlibrary(readr)\nlibrary(skimr)\nlibrary(knitr)\nlibrary(tidyverse)\nlibrary(corrplot)\nlibrary(ggcorrplot)\nlibrary(ggthemes)\nlibrary(tinythemes)\nlibrary(kableExtra)\nlibrary(rlang)\nlibrary(gridExtra)\nlibrary(patchwork)\nlibrary(mice)\nlibrary(psych)\nlibrary(VennDiagram)\nlibrary(ggVennDiagram)\n```\n\n## Zapoznanie z Danymi\n\nWczytanie pliku z rozszerzeniem `csv` do zmiennej o nazwie `data`.\n\n```{r}\ndata <- read.csv2(\"data/badania.csv\", sep=\",\")\n```\n\nSprawdźmy jak wyglądają nasze dane. Użyjemy do tego funkcji `head()` oraz `tail()` do podglądu kilku pierwszych i ostatnich obserwacji w naszym zbiorze danych. Pierwsze 10 obserwacji ma postać:\n\n```{r}\nhead(data)\n```\n\nNatomiast kilka ostatnich obserwcji nad którymi bedziemy pracować mają postać:\n\n```{r}\ntail(data)\n```\n\nSpradźmy rozmiary naszej ramki danych. W tym celu posłużymy się funkcjami `nrow()` oraz `ncol()`, które zawracają odpowiednio **liczbę wierszy** oraz **liczbę kolumn**.\n\n```{r}\nnrow(data)\nncol(data)\n```\n\nWidzimy że mamy ponad 4200 obserwacji i 16 zmiennych, które posłużą nam do stworzenia kilku modeli predykcyjnych i wyboru tego, który najlepiej będzie oceniał ryzyko zawału serca. Jest to naprawdę duży zasób danych, które mogą odpowiedzieć na wiele interesujących pytań. Nadszedł czas sprawdzić zmienne, które posiadamy. Użyjemy do tego funkcji `colnames().`\n\n```{r}\ncolnames(data)\n```\n\nOkazuje się, że nasz zbiór zawiera cenne informacje medyczne takie jak:\n\n1.  Tętno\n\n2.  BMI\n\n3.  Ciśnienie skurczowe i rozkurczowe\n\n4.  Poziom cholesterolu i glukozy\n\n5.  Informacje o tym, czy pacjent był palaczem, czy też nie\n\nDokładniej przyjrzymy się naszym zmiennym w dalszej części analizy zbioru danych. Wyjaśnimy dokładniej cechy poszczególnych kolumn zbioru danych oraz ich podstawowe statystyki. Czas sprawdzić podstawowe statystki dotyczące danych oraz to z jakimi typami danych będziemy pracować.\n\n```{r}\nskim(data)\n```\n\nTak jak widać na powyższym raporcie, zaczytując dane otrzymujemy 3 zmienne typu `character` oraz 13 zmiennych typu `numeric`. Taki podział ze względu na typ zmiennych nie jest odpowiedni. Wszystkie cechy typu `character` mają w naszym przypadku błędne formatowanie. Dodatkowo będziemy musieli dodać nowe typy zmiennych takie jak `boolean` oraz `factor`, aby móc szybko i praktycznie pracować z danymi. Odpowiedni wybór typów zmiennych jest podstawowym krokiem rozpczynając analizę zbioru danych. Zrobimy to w następujący sposób.\n\nbadania_sorted \\<- badania\\[order(is.na(badania\\$glucose), decreasing = TRUE), \\]\n\n```{r}\nbadania <- data |> \n  mutate(\n    sysBP = as.numeric(sysBP),\n    diaBP = as.numeric(diaBP),\n    BMI = as.numeric(BMI),\n    sex = factor(male, levels = c(0, 1), labels = c(\"Female\", \"Male\")),\n    education = factor(education, ordered = TRUE),\n    currentSmoker = factor(currentSmoker, labels = c(\"No\", \"Yes\")),\n    BPMeds = factor(BPMeds, labels = c(\"No\", \"Yes\")),\n    prevalentStroke = factor(prevalentStroke, labels = c(\"No\", \"Yes\")),\n    prevalentHyp = factor(prevalentHyp, labels = c(\"No\", \"Yes\")),\n    diabetes = factor(diabetes, labels = c(\"No\", \"Yes\")),\n    TenYearCHD = factor(TenYearCHD, labels = c(\"No\", \"Yes\"))\n  ) |> dplyr::select(-male)   \n\nbadania <- badania[order(is.na(badania$glucose), decreasing = TRUE), ]\n```\n\nW tym momencie wszystkie zmienne mają przypisane odpowiednie typy danych, co pozwoli zaoszczędzić czas podczas przeprowadzania obliczeń i analizy nad nimi. Dla wygody uporządkujemy teraz kolumny w odpowiedniej dla nas kolejności, tak aby informacje powiązane ze sobą były obok siebie (Np. zmienna `glucose` obok zmiennej `diabetes`)\n\n```{r}\nbadania <- dplyr::select(badania, c(1, 16, 2, 10, 11, 13, 12, 9, 14, 8, 4, 3, 5:7, 15))\nhead(badania)\n```\n\nZrobione. Teraz możemy przejść do wyjaśnienia zmiennych, aby było jasne z czym pracujemy oraz na czym możemy polegać podczas wykonywania analizy.\n\n## Opis i wyjaśnienie zmiennych\n\nPoniżej znajduje się tabela zawierająca wszystkie cechy wraz z ich wytłumaczeniem.\n\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| Zmienna           | Opis                                                                 | Jednostka                                                    | Typ         |\n+:=================:+:====================================================================:+:============================================================:+:===========:+\n| `age`             | Wiek (w latach)                                                      | Lata                                                         | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `sex`             | Płeć (1 - Mężczyzna, 0 - Kobieta)                                    | Brak                                                         | `factor`    |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `education`       | Wykształcenie                                                        | Brak                                                         | `factor`    |\n|                   |                                                                      |                                                              |             |\n|                   | (1 - Brak ukończonej szkoły średniej,                                |                                                              |             |\n|                   |                                                                      |                                                              |             |\n|                   | 2 - Ukończona szkoła średnia,                                        |                                                              |             |\n|                   |                                                                      |                                                              |             |\n|                   | 3 - Nieukończone studia lub ukończona szkoła zawodowa,               |                                                              |             |\n|                   |                                                                      |                                                              |             |\n|                   | 4 - Wykształcenie Wyższe)                                            |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `sysBP`           | Wartość ciśnienia skurczowego (Średnia ostatnich dwóch pomiarów)     | mmHg                                                         | `numerical` |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `diaBP`           | Wartość ciśnienia rozkurczowego (Średnia ostatnich dwóch pomiarów)   | mmHg                                                         | `numerical` |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `heartRate`       | Poziom tętna ()                                                      | Uderzeń na minutę                                            | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `BMI`             | Wartość współczynnika BMI                                            | $\\displaystyle \\frac{\\text{masa (kg)}}{\\text{wzrost (m)}^2}$ | `float`     |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `totalChol`       | Wartość poziomu cholesterolu ()                                      | $\\displaystyle \\frac{\\text{mg}}{\\text{dL}}$                  | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `glucose`         | Poziom glukozy we krwi ()                                            | $\\displaystyle \\frac{\\text{mg}}{\\text{dL}}$                  | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `diabetes`        | Fakt czy pacjent jest cukrzykiem\\                                    | brak                                                         | `factor`    |\n|                   | (1 - Tak, 0 - Nie)                                                   |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `cigsPerDay`      | Średnia liczba palonych dziennie papierosów                          | sztuki                                                       | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `currentSmoker`   | Fakt czy pacjent jest palaczem\\                                      | brak                                                         | `factor`    |\n|                   | (1- Tak, 0 - Nie)                                                    |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `BMPmeds`         | Fakt czy pacjent leczy się na nadciśnienie krwi (1 - Tak, 0 - Nie)   | brak                                                         | `factor`    |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `prevalentStroke` | Wskazuje czy pacjent przeżył udar mózgu. (1 - Tak, 0 - Nie)          | brak                                                         | `factor`    |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `prevalentHyp`    | Wskazuje czy u pacjenta występowało nadciśnienie.\\                   | brak                                                         | `factor`    |\n|                   | (1 - Tak, 0 - Nie)                                                   |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `TenYearCHD`      | Wskazuje 10-letnie ryzyko wystąpienia choroby wieńcowej u pacjenta.\\ | brak                                                         | `factor`    |\n|                   | (1- Tak, 0-Nie)                                                      |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n\n## Uzupełnienie brakujących wartości\n\nZastanówmy się co zrobić z brakami danych w naszym zbiorze badań. Przedstawmy ilość wartości `NA` dla każdej zmiennej, w której takie wartości wystepują.\n\n```{r}\n#| label: NA_columns\n#| warning: false\nNA_count <- colSums(is.na(badania))[colSums(is.na(badania)) > 0] |> \n  data.frame()\n\nnames(NA_count) <- \"count\"\nNA_count$var = rownames(NA_count)\nrownames(NA_count) <- NULL\nNA_count <- select(NA_count, c(2,1))\n\np <- ggplot(NA_count, aes(x = var, y = count)) +\n  geom_col(show.legend = FALSE, fill = \"#6AAED9\") +\n  theme_ipsum_rc() +\n  geom_text(aes(label = count), vjust = -0.5) + \n  expand_limits(y = max(NA_count$count) * 1.1) +\n  labs(title = \"Liczba wartości NA w zmiennych\")\n\nggsave(\"images/plots/na_count_before.png\", p)\n```\n\n![](images/plots/na_count_before.png){fig-align=\"center\"}\n\n![](){fig-align=\"center\"}\n\nWidzimy, że mamy kilka zmiennych, które zawierają braki danych. Liczby wartośći `NA` w poszczególnych kolumnach są zazwyczaj mniejsze lub równe około 100, jedynym wyjątkiem z aż 388 wartościami `NA` jest zmienna `glucose` oznaczająca poziom glukozy we krwi pacjenta. Zanim uzupełnimy braki danych odpowiednią techniką spróbujemy dowiedzieć się w jaki sposób rozkładają się wartości `NA` tzn. czy braki te wystepują u różnych pacjentów, czy też jeden pacjent posiada brak informacji w więcej niż tylko jednej zmiennej.\n\n```{r}\n#| label: NA_rows\nNA_df <- data.frame(NA_w_wierszu = rowSums(is.na(badania))) |> \n  group_by(NA_w_wierszu) |> \n  summarise(liczebnosc = n())\n\np <- NA_df |> ggplot(aes(NA_w_wierszu, liczebnosc)) +\n  geom_col(show.legend = FALSE, fill = \"#6AAED9\") +\n  theme_ipsum_rc() +\n  geom_text(aes(label = liczebnosc), vjust = -0.5) + \n  expand_limits(y = max(NA_df$liczebnosc) * 1.1) +\n  labs(title = \"Liczba wartości NA w rekordach\")\n\nggsave(\"images/plots/NA_count_perRow.png\", p)\n```\n\n![](images/plots/NA_count_perRow.png){fig-align=\"center\"}\n\nDo uzupełniania wartości brakujących przyjeliśmy następującą metodykę:\n\n-   Rekordy posiadające dokładnie jedną wartość `NA` uzupełnimy na podstawie metody wielokrotnej imputacji\n\n-   Rekordy posiadające więcej niż jedną wartość `NA` odrzucamy, aby nie bazować na znacznie brakujących danych\n\nW zmiennej `badania` wybieramy te wiersze, w których znajduje się co najwyżej jedna wartość `NA`.\n\n```{r}\nbadania <- badania[rowSums(is.na(badania)) <= 1, ]\n```\n\n```{r}\n#| warning: false\n#| echo: false\nNA_count <- colSums(is.na(badania))[colSums(is.na(badania)) > 0] |> \n  data.frame()\n\nnames(NA_count) <- \"count\"\nNA_count$var = rownames(NA_count)\nrownames(NA_count) <- NULL\nNA_count <- select(NA_count, c(2,1))\n\np <- ggplot(NA_count, aes(x = var, y = count)) +\n  geom_col(show.legend = FALSE, fill = \"#6AAED9\") +\n  theme_ipsum_rc() +\n  geom_text(aes(label = count), vjust = -0.5) + \n  expand_limits(y = max(NA_count$count) * 1.1) +\n  labs(title = \"Liczba wartości NA w zmiennych\")\n\nggsave(\"images/plots/na_count_after.png\", p)\n```\n\nWizualizacja liczby brakujących danych ma postać:\n\n::: panel-tabset\n### Po wczytaniu danych\n\n![](images/plots/na_count_before.png){fig-align=\"center\"}\n\n### Po wstępnym usunięciu danych\n\n![](images/plots/na_count_after.png){fig-align=\"center\"}\n:::\n\nW tym momencie przeprowadzimy proces uzupełniania zmiennych przy pomocy funkcji `mice` - metodą wielokrotnej imputacji. Braki danych znajdują się w kolumnach o różnych typach zmiennych.\n\n**Zmienne kategoryczne:**\n\n-   `BPMeds`\n\n-   `education`\n\n**Zmienne numeryczne:**\n\n-   `BMI`\n\n-   `cigsPerDay`\n\n-   `glucose`\n\n-   `heartRate`\n\n-   `totChol`\n\nZe względu na typy zmiennych oraz rozkłady, jakimi te zmienne się charakteryzują decydujemy się użyć metodę `pmm` (Predictive Mean Matching) dla zmiennych numerycznych oraz metodę `logreg` dla `BPMeds` oraz `polr` dla `education`.\n\n**Uzasadnienie:** `pmm` zachowuje rozkłady i wybiera realne obserwacje jako wartości wejściowe, co jest szczególnie ważne przy zmiennych o rozkładzie ciągłym. Dla zmiennych kategorycznych używamy odpowiednich regresji klasyfikacyjnych w zależności od cech zmiennej.\n\n```{r}\n#| output: false\nstatystyki_przed <- describe(badania[NA_count$var])\nmetody <- make.method(badania)\n\nmetody[\"BPMeds\"] <- \"logreg\"        #\nmetody[\"education\"] <- \"polr\" \nmetody[\"BMI\"] <- \"pmm\"\nmetody[\"cigsPerDay\"] <- \"pmm\"\nmetody[\"glucose\"] <- \"pmm\"\nmetody[\"heartRate\"] <- \"pmm\"\nmetody[\"totChol\"] <- \"pmm\"\nuzupelnienia <- mice(badania,\n                m = 5,\n                method = metody,\n                seed = 2025)\nbadania <- complete(uzupelnienia)\nstatystyki_po <- describe(badania[NA_count$var])\n\n```\n\nPo uzupełnieniu brakujących wartości porównajmy statystyki dla naszych zmiennych.\n\n::: panel-tabset\n### Przed uzupełnieniem danych\n\n```{r}\nround(data.frame(t(statystyki_przed))[c(2:9,10:12), ], 3)\n```\n\n### Po uzupełnieniu danych\n\n```{r}\nround(data.frame(t(statystyki_po))[c(2:9,10:12), ], 3)\n```\n:::\n\nSprawdzając podstawowe statystki widzimy, że uzupełniając dane zachowaliśmy ich strukturę. Różnica pomiędzy wartościami statystyk polega najczęściej na zmianie części tysięcznych lub setnych, więc wartości `NA` zostały bardzo dobrze odwzorowane. Teraz możemy wykonać analizę wstępną naszego zbioru danych, aby następnie przejść do stworzenia modeli predykcyjnych oraz głębszej analizy. Ostatnim punktem pracy nad modyfikowaniem naszych danych jest zapisanie oszyszczonych i uzupełnionych danych do pliku `.csv`, który wykorzystamy m. in. podczas tworzenia modeli w języku programowania `R` lub `python.`\n\n```{r}\nwrite.csv(badania, file = \"badania.csv\")\n```\n\n## Analiza Danych\n\nW trakcie wykonowynia wizualizacji bedziemy posługiwać się pacjentami, których traktujemy jako tych, którzy nie są w grupie zagrożenia oraz tych, którzy w tej grupie są. Dla ułatwienia przeprowadzania operacji stworzymy dwie ramki danych `zdrowi` oraz `chorzy` aby odwoływać się do tych grup bezpośrednio.\n\n```{r}\nbadania <- mutate(badania, ID = 1:nrow(badania))\nzdrowi <- badania |> \n  subset(TenYearCHD == \"No\")\n\nchorzy <- badania |> \n  subset(TenYearCHD == \"Yes\")\n```\n\n### Funkcja Tworzenia Wykresów\n\n```{r}\n#| warning: false\nzmienna_wykres <- function(dane, typ_zmiennej, typ_wykresu) {\n  my_plots = list()\n  if (typ_zmiennej == \"kategoryczna\") {\n    dane <- dane |> \n      dplyr::select(where(is.factor))\n  } else if (typ_zmiennej == \"numeryczna\") {\n    dane <- dane |> \n      dplyr::select(where(is.numeric))\n  } else {\n    # nic nie robimy\n  }\n  \n  for (i in 1:ncol(dane)) {\n    kolumna <- colnames(dane)[i]\n    if (typ_wykresu == \"barplot\") {\n    p <- ggplot(dane, aes(x = !!sym(kolumna), fill = !!sym(kolumna))) +\n      geom_bar(show.legend = FALSE, width = 0.6) +\n      theme_ipsum_rc() +\n      ggtitle(kolumna) +\n      scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\"))\n      \n    \n    } else if (typ_wykresu == \"pie\") {\n      p <- dane %>%\n        dplyr::count(!!sym(kolumna)) %>%\n        ggplot(aes(x = \"\", y = n, fill = !!sym(kolumna))) +\n        geom_bar(stat = \"identity\", width = 1, color = \"white\") +\n        coord_polar(theta = \"y\") +\n        theme_void() +\n        ggtitle(kolumna) +\n        scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\"))\n      \n    } else if (typ_wykresu == \"histogram\") {\n      p <- ggplot(dane, aes(x = !!sym(kolumna))) +\n        geom_histogram(bins = 20, show.legend = FALSE, fill = \"#6AAED9\", color = \"black\") +\n        theme_ipsum_rc() +\n        ggtitle(kolumna)\n        \n      \n    } else if (typ_wykresu == \"violin\") {\n      p <- ggplot(dane, aes(x = \"\", y = !!sym(kolumna), fill = \"#6AAED9\")) +\n        geom_violin(show.legend = FALSE) +\n        theme_ipsum_rc() +\n        ggtitle(kolumna) +\n        scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\"))\n    } else {\n      next  # pomiń jeśli nieznany typ wykresu\n    }\n    my_plots[[i]] <- p\n  } \n\n  \ngotowy_wykres_1 <- (my_plots[[1]] + my_plots[[2]]) / (my_plots[[3]] + my_plots[[4]]) \ngotowy_wykres_2 <- (my_plots[[5]] + my_plots[[6]]) / (my_plots[[7]] + my_plots[[8]])\nggsave(paste0(\"images/plots/\", typ_zmiennej, \"_\", typ_wykresu, \"1.png\"), gotowy_wykres_1)\nggsave(paste0(\"images/plots/\", typ_zmiennej, \"_\", typ_wykresu, \"2.png\"), gotowy_wykres_2)\n}\n```\n\nTak zbudowana funkcja pozwala nam na generowanie wykresów w zależności od:\n\n-   Typu zmiennej\n\n-   Typu wykresu\n\nDzięki temu możemy szybko i prosto uzyskać wiele wizualizacji na temat interesujących nas zmiennych. Zdecydowaliśmy się przedstawić nasze zmienne z podziałem na:\n\n1.  Zmienne typu kategorycznego, przedstawiając liczebność ogólną oraz względem siebie, za pomocą wykresów `barplot` oraz `pie`.\n\n2.  Zmienne typu numerycznego, przedstawiając gęstośc oraz rozkład zmiennej, za pomocą wykresów `violin` oraz `histogram`\n\nPoniżej przedstawiamy efekty naszej pracy, gdzie przeanalizujemy poszczególne zmienne.\n\n### Zmienne Kategoryczne\n\n```{r}\n#| label: Kategoryczne_Wstep\nzmienna_wykres(badania, \"kategoryczna\", \"barplot\")\nzmienna_wykres(badania, \"kategoryczna\", \"pie\")\n```\n\n::: panel-tabset\n#### Barplot\n\n![](images/plots/kategoryczna_barplot1.png){fig-align=\"center\"}\n\n![](images/plots/kategoryczna_barplot2.png){fig-align=\"center\"}\n\n#### Pie\n\n![](images/plots/kategoryczna_pie1.png){fig-align=\"center\"}\n\n![](images/plots/kategoryczna_pie2.png){fig-align=\"center\"}\n:::\n\n**Po przeanalizowaniu wykresów nasuwają się nastepujące wnioski:**\n\n-   Analizujemy zbiór ponad 4.000 osób, w którym kobiety lekko przewyższają swoją liczebnością mężczyzn.\n\n-   Wraz z poziomem wykształcenia zmniejsza się liczba osób w danej kategorii wykształcenia. Osób bez ukończonej szkoły średniej jest około 1750, stopniowo zmniejszając się do 500 osób z wykształceniem wyższym. Wśród naszych danych przeważają osoby bez wykształcenia lub jedynie z wykształceniem średnim.\n\n-   Podział na osoby palące i niepalące jest jednakowy. Obie grupy zawierają około 2.000 osób.\n\n-   Grupy osób w których skład wchodzą osoby z cukrzycą, osoby leczące nadciśnienie krwi oraz osoby, które przeżyły udar mózgu są bardzo nieliczne. Ograniczają się maksymalnie do kilkudziesięciu osób. Mimo wszystko osoby te mogą dostarczyć wiele cennych informacji w dalszej analizie ryzyka choroby serca.\n\n-   Bazujemy na danych w których stosunek liczby osób, u których nie występowało nadciśnienie do liczby osób u których nadciśnienie występowało jest równe w przybliżeniu 2:1.\n\n-   Zmienna predykcyjna `TenYearCHD` przewiduje potencjalne ryzyko choroby serca dla ponad 500 osób, co stanowi około 12.5% liczby wszystkich badanych. Oznacza to, że średnio co 8 badana osoba jest kwalifikowana w grupie ryzyka.\n\n### Zmienne numeryczne\n\n```{r}\n#| label: Numeryczne_Wstep\nzmienna_wykres(badania, \"numeryczna\", \"violin\")\nzmienna_wykres(badania, \"numeryczna\", \"histogram\")\n```\n\n::: panel-tabset\n#### Violin\n\n![](images/plots/numeryczna_violin1.png){fig-align=\"center\"}\n\n![](images/plots/numeryczna_violin2.png){fig-align=\"center\"}\n\n#### Histogram\n\n![](images/plots/numeryczna_histogram1.png){fig-align=\"center\"}\n\n![](images/plots/numeryczna_histogram2.png){fig-align=\"center\"}\n:::\n\n**Po przeanalizowaniu wykresów nasuwają się nastepujące wnioski:**\n\n-   Badamy grupę osób, w której większość osób ma od 35 do 65 lat.\n\n-   Ciśnienie rozkurczowe zawiera się głównie w przedziale \\<70; 90\\> natomiast ciśnienie skurczowe w przedziale \\<115; 140\\>\n\n-   Najczęściej badane osoby posiadają tętno serca na poziomie 70-80 uderzeń na minutę.\n\n-   Interesujący jest rozkład zmiennej `cigsPerDay`. Widać znaczący wzrost wystąpień osób palących 20 papierosów dziennie. Dokładnie taka liczba papierosów znajduje się w pojedyńczej paczce. Możemy zatem przyjąć, że dla wielu osób codziennym nawykiem jest wypalenie dokładnie całej paczki w trakcie dnia.\n\n-   Zmienne cechują się niesymetrycznym rozkładem, dodatkowo zaburzone są rozkłady dla zmiennej `age` oraz `cigsPerDay`.\n\n-   Większość zmiennych jest prawostronnie asymetryczna, ciężko mówić o normalności rozkładów ze względu na obecność wartości odstających, które są powszechne wśród danych medycznych.\n\n### Zależności pomiędzy zmiennymi\n\nWśród naszych zmiennych mogą istnieć zależności liniowe. W celu sprawdzenia tego faktu stworzymy macierz korelacji, aby przedstawić jak wygląda korelacja pomiędzy poszczególnymi zmiennymi. Posłużymy się w tym celu zmiennymi numerycznymi.\n\n```{r}\n#| label: Korelacja\ncor_mat <- badania %>% \n  select(where(is.numeric)) %>% \n  cor()\n\np <- ggcorrplot(\n    cor_mat,\n    lab = TRUE,               \n    type = \"lower\",           \n    hc.order = TRUE,          #\n    outline.col = \"white\",\n    ggtheme = ggplot2::theme_minimal(),\n    colors = c(\"#6AAED9\", \"white\", \"#F25041\") \n) + ggtitle(\"Macierz Korelacji\")\nggsave(\"images/plots/korelacja.jpg\", p)\n```\n\n![](images/plots/korelacja.jpg){fig-align=\"center\"}\n\nWidzimy, że istnieje duża korelacja równa 0.78 pomiędzy zmiennymi `sysBP` oraz `diaBP`. Nie powinno nas to specjalnie dziwić, ponieważ wartość ciśnienia rozkurczowego ma bezpośredni wypływ na wartość ciśnienia skurczowego. Dodatkowo poziom BMI a co za tym idzie - nasza waga ma wpływ na wartośc ciśnienia rozkurczowego oraz skurczowego. W oczy może rzucić nam się również wartość korelacji na poziomie -0.19 między zmienną `age` oraz `cigsPerDay`, która oznacza, że wraz z wiekiem palimy coraz mniej papierosów dziennie. Nie są to jednak wysokie wartości współczynnika korelacji, więc nie możemy powiedzieć, że pomiędzy tymi zmiennymi istnieje statystycznie istotna korelacja. Możemy jedna informacje traktować jako wskazówki podczas dalszej analizy i zgłębić analizę w kierunku tych zmiennych.\n\n### Relacja pomiędzy diaBP oraz sysBP\n\nSprawdźmy jak będzie wyglądać zestawienie wartości ciśnienia skurczowego od wartości ciśnienia rozkurczowego, dodatkowo dodamy kilka czynników, które dotakowo pokażą zależności pomiędzy większą liczbą zmiennych.\n\n```{r}\n#| label: sysBP_wzgledem_diaBP\np1 <- ggplot(badania, aes(x = diaBP, y = sysBP, color = sex, shape = sex)) +\n  geom_point() +\n  theme_ipsum_rc() +\n  ggtitle(\"sysBP ~ diaBP\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\nggsave(\"images/plots/sysBP_wzgledem_diaBP.jpg\", p1)\n\n```\n\n![](images/plots/sysBP_wzgledem_diaBP.jpg){fig-align=\"center\"}\n\nZe względu na dużą liczbę rekordów, punkty zaznaczone na wykresie typu `scatter plot` tworzą masywną chmurę punktów, utrudniając interpretację. Aby ułatwić analizę na podstawie wykresu posłużymy się wykresami gęstości porównując dodatkowo wpływ innych zmiennych na wartość ciśnienia rozkurczowego oraz skurczowego.\n\n### Ciśnienie rozkurczowe\n\n```{r}\n#| label: diaBP\np1 <- ggplot(badania, aes(x = diaBP, color = sex)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of diaBP by Sex\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  theme(legend.position = \"bottom\")\n\np2 <- ggplot(badania, aes(x = diaBP, color = education)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of diaBP by Education Level\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\np3 <- ggplot(badania, aes(x = diaBP, color = currentSmoker)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of diaBP by Smoking\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\nggsave(\"images/plots/diaBP_bySex.jpg\", p1)\nggsave(\"images/plots/diaBP_byEducation.jpg\", p2)\nggsave(\"images/plots/diaBP_byCurrentSmoker.jpg\", p3)\n```\n\n::: panel-tabset\n#### Względem zmiennej sex\n\n![](images/clipboard-1376958334.jpeg)\n\n#### Względem zmiennej education\n\n![](images/plots/diaBP_byEducation.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej currentSmoker\n\n![](images/plots/diaBP_byCurrentSmoker.jpg){fig-align=\"center\"}\n:::\n\n::analiza::\n\n### Ciśnienie skurczowe\n\nAnalogicznie postepujemy dla zmiennej `sysBP`. Pamiętamy że omawiane zmienne są silnie ze sobą skorelowane, więc spodziewamy się podobnych rezultatów.\n\n```{r}\n#| label: sysBP\np1 <- ggplot(badania, aes(x = sysBP, color = sex)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of sysBP by Sex\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  theme(legend.position = \"bottom\")\n\np2 <- ggplot(badania, aes(x = sysBP, color = education)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of sysBP by Education Level\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\np3 <- ggplot(badania, aes(x = sysBP, color = currentSmoker)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of sysBP by Smoking\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\nggsave(\"images/plots/sysBP_bySex.jpg\", p1)\nggsave(\"images/plots/sysBP_byEducation.jpg\", p2)\nggsave(\"images/plots/sysBP_byCurrentSmoker.jpg\", p3)\n```\n\n::: panel-tabset\n#### Względem zmiennej sex\n\n![](images/plots/sysBP_bySex.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej education\n\n![](images/plots/sysBP_byEducation.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej currentSmoker\n\n![](images/plots/sysBP_byCurrentSmoker.jpg){fig-align=\"center\"}\n:::\n\nanaliza::\n\n### Zakres pracy serca, a ryzyko zawału\n\n```{r}\n#| label: Pulse_pressure\n#| warning: false\np1 <- badania |> \n  mutate(range_diff = sysBP - diaBP) |> \n  arrange(range_diff) |> \n  ggplot(aes(x = range_diff, color = TenYearCHD)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  labs(title = \"Pulse pressure distribution\", x = \"sysBP - diaBP\")\n\np2 <- badania |> \n  mutate(range_diff = sysBP - diaBP) |> \n  arrange(range_diff) |> \n  ggplot(aes(x = range_diff, color = prevalentHyp)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  labs(title = \"Pulse pressure distribution\", x = \"sysBP - diaBP\")\n\np3 <- badania |> \n  mutate(range_diff = sysBP - diaBP) |> \n  arrange(range_diff) |> \n  ggplot(aes(x = range_diff, color = diabetes)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  labs(title = \"Pulse pressure distribution\", x = \"sysBP - diaBP\")\n\nggsave(\"images/plots/pulse_pressure_1.jpg\", p1)\nggsave(\"images/plots/pulse_pressure_2.jpg\", p2)\nggsave(\"images/plots/pulse_pressure_3.jpg\", p3)\n```\n\n::: panel-tabset\n#### Względem zmiennej TenYearCHD\n\n![](images/plots/pulse_pressure_1.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej prevalentHyp\n\n![](images/plots/pulse_pressure_2.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej diabetes\n\n![](images/plots/pulse_pressure_3.jpg){fig-align=\"center\"}\n:::\n\n:analiza::\n\n### Ciśnienie serca jako przyczyna zawału serca\n\n#### Z uzględnieniem płci\n\n```{r}\n#| label: Cisnienie_wzgledem_ryzyka\n#| warning: false\np1 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = sysBP, color = sex)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) + \n  ggtitle(\"Value of sysBP by Sex\")\n\np2 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = diaBP, color = sex)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n   ggtitle(\"Value of diaBP by Sex\")\n\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_bySex_1.png\", p1)\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_bySex_2.png\", p2)\n```\n\n::: panel-tabset\n##### Ciśnienie skurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_bySex_1.png){fig-align=\"center\"}\n\n##### Ciśnienie rozkurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_bySex_2.png){fig-align=\"center\"}\n:::\n\n#### Z uwzględnieniem nadciśnienia\n\n```{r}\n#| label: Cisnienie_wzgledem_ryzyka_2\np1 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = sysBP, color = prevalentHyp)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) + \n  ggtitle(\"Value of sysBP by the fact of prevalent Hypothesis\")\n\np2 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = diaBP, color = prevalentHyp)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n   ggtitle(\"Value of diaBP by the fact of prevalent Hypothesis\")\n\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_1.png\", p1)\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_2.png\", p2)\n```\n\n::: panel-tabset\n##### Ciśnienie skurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_1.png){fig-align=\"center\"}\n\n##### Ciśnienie rozkurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_2.png){fig-align=\"center\"}\n:::\n\n#### Rozkład wartości ciśnienia\n\n```{r}\n#| label: rozklad_cisnienia\n#| warning: false\n\np1 <- badania |> \n  ggplot(aes(x = sysBP, color = TenYearCHD)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Distribution of sysBP including risk of disease\")\n\np2 <- badania |> \n  ggplot(aes(x = diaBP, color = TenYearCHD)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Distribution of diaBP including risk of disease\")\n\nggsave(\"images/plots/rozklad_cisnienia_1.png\", p1)\nggsave(\"images/plots/rozklad_cisnienia_2.png\", p2)\n```\n\n::: panel-tabset\n##### Ciśnienie skurczowe\n\n![](images/plots/rozklad_cisnienia_1.png){fig-align=\"center\"}\n\n##### Ciśnienie rozkurczowe\n\n![](images/plots/rozklad_cisnienia_2.png){fig-align=\"center\"}\n:::\n\n### Analiza wartości tętna\n\n```{r}\n#| label: poziom_tetna\n#| warning: false\nbins <- seq(min(badania$heartRate), max(badania$heartRate), length.out = 16)\n\nhist_data <- badania %>%\n  mutate(bin = cut(heartRate, breaks = bins, include.lowest = TRUE)) %>%\n  count(TenYearCHD, bin) %>%\n  mutate(count_adj = ifelse(TenYearCHD == \"No\", n, -n))\n\n\np <- hist_data |> \n  ggplot(aes(x = bin, y = count_adj, fill = TenYearCHD)) +\n  geom_col(position = \"identity\") +\n  labs(y = \"Liczebność w grupie\", x = \"Przedziały\") +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\"))\n  \nggsave(\"images/plots/poziom_tetna.png\", p)\n```\n\n![](images/plots/poziom_tetna.png){fig-align=\"center\"}\n\n#### Rozkład zmiennej\n\n```{r}\n#| label: rozklad_tetna_gestosc\n#| warning: false\np <- badania |> \n  ggplot(aes(x = heartRate)) +\n  geom_density(color = \"#6AAED9\", lwd = 1.2) +\n  stat_function(\n    fun = dnorm,\n    args = list(mean = mean(badania$heartRate), sd = sd(badania$heartRate)),\n    linewidth = 1.2,\n    col = \"#F25041\"\n  ) +\n  theme_ipsum_rc()\n\nggsave(\"images/plots/rozklad_tetna_gestosc.png\", p)\n```\n\n![](images/plots/rozklad_tetna_gestosc.png){fig-align=\"center\"}\n\n#### Poziom tętna ze względu na inne zmienne\n\n```{r}\n#| label: heartRate_by\n#| warning: false\np1 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = heartRate, color = sex)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"heartRate ~ TenYearCHD\")\n\np2 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = heartRate, color = currentSmoker)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"heartRate ~ TenYearCHD\")\n\np3 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = heartRate, color = BPMeds)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"heartRate ~ TenYearCHD\")\n\nggsave(\"images/plots/heartRate_bySex.png\", p1)\nggsave(\"images/plots/heartRate_bycurrentSmoker.png\", p2)\nggsave(\"images/plots/heartRate_byBPMeds.png\", p3)\n```\n\n::: panel-tabset\n##### sex\n\n![](images/plots/heartRate_bySex.png){fig-align=\"center\"}\n\n##### currentSmoker\n\n![](images/plots/heartRate_bycurrentSmoker.png){fig-align=\"center\"}\n\n##### BPMeds\n\n![](images/plots/heartRate_byBPMeds.png){fig-align=\"center\"}\n:::\n\n### Leki na nadciśnienie i ich skutek\n\n```{r}\n#| label: leki_nadcisnienie\n#| warning: false\np1 <- badania |> \n  ggplot(aes(x = sysBP, color = BPMeds)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\"))\n\np2 <- badania |> \n  ggplot(aes(x = diaBP, color = BPMeds)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\"))\n\nggsave(\"images/plots/leki_nadcisnienie_rozklad1.png\", p1)\nggsave(\"images/plots/leki_nadcisnienie_rozklad2.png\", p2)\n```\n\n::: panel-tabset\n#### Ciśnienie skurczowe\n\n![](images/plots/leki_nadcisnienie_rozklad1.png){fig-align=\"center\"}\n\n#### Ciśnienie rozkurczowe\n\n![](images/plots/leki_nadcisnienie_rozklad2.png){fig-align=\"center\"}\n:::\n\n### Skutki palenia na układ krążenia\n\n```{r}\nosoby_palace <- badania |> \n  subset(currentSmoker == \"Yes\")\n\nosoby_niepalace <- badania |> \n  subset(cigsPerDay == 0)\n\ndata.frame(osoby_palace = nrow(osoby_palace),\n           osoby_niepalace = nrow(osoby_niepalace),\n           row.names = \"Liczba osób\"\n           )\n```\n\n#### Podział pacjentów ze względu na palenie\n\n```{r}\n#| warning: false\n\np1 <- badania |> \n  ggplot(aes(x = currentSmoker, fill = currentSmoker)) +\n  geom_bar(fill = c(\"#6AAED9\", \"#F2A391\"), width = 0.3, color = \"black\") +\n  theme_ipsum_rc() +\n  ggtitle(\"Smokers vs No Smokers\")\n\np2 <- badania |> \n  ggplot(aes(x = currentSmoker, fill = sex)) +\n  geom_bar(position = position_dodge(width = 0.7), color = \"black\",  width = 0.6) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Smoking including sex\")\n\np3 <- badania |> \n  ggplot(aes(x = currentSmoker, fill = TenYearCHD)) +\n  geom_bar(position = position_dodge(width = 0.7), color = \"black\",  width = 0.6) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Smoking including potential risk of disease\")\n\nggsave(\"images/plots/number_of_smokers.png\", p1)\nggsave(\"images/plots/number_of_smokers_bySex.png\", p2)\nggsave(\"images/plots/number_of_smokers_byTenYearCHD.png\", p3)\n```\n\n::: panel-tabset\n##### Distribution by Smoking Status\n\n![](images/plots/number_of_smokers.png){fig-align=\"center\"}\n\n##### Number of Smokers by sex\n\n![](images/plots/number_of_smokers_bySex.png){fig-align=\"center\"}\n\n##### Number of smokers including disease risk\n\n![](images/plots/number_of_smokers_byTenYearCHD.png){fig-align=\"center\"}\n:::\n\n#### Nawyki palenia papierosów\n\n```{r}\n#| label: cigs_per_Day\n#| warning: false\n\np1 <- badania |> \n  ggplot(aes(x = cigsPerDay)) +\n  geom_bar(fill = \"#6AAED9\") +\n  theme_ipsum_rc()\n\n\np2 <- osoby_palace |> \n  ggplot(aes(x = cigsPerDay)) +\n  geom_bar(fill = \"#6AAED9\") +\n  theme_ipsum_rc()\n\nggsave(\"images/plots/cigsPerDay1.png\", p1)\nggsave(\"images/plots/cigsPerDay2.png\", p2)\n```\n\n::: panel-tabset\n##### Uwzględniając wszystkich pacjentów\n\n![](images/plots/cigsPerDay1.png){fig-align=\"center\"}\n\n##### Uwzględnając tylko osoby palące\n\n![](images/plots/cigsPerDay2.png){fig-align=\"center\"}\n:::\n\n#### Wpływ poziomu palenia na ryzyko choroby\n\n```{r}\n#| label: impact_of_smkoing\n#| warning: false\npaczki <- badania |> \n  group_by(cigsPerDay, TenYearCHD) |> \n  summarise(n = n(), .groups = \"drop\") |> \n  group_by(cigsPerDay) |>\n  mutate(perc = n / sum(n) * 100)\n\np1 <- paczki[1:28, ] |> \n  ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Liczba osób\",\n    fill = \"TenYearCHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Impact of smoking for potential risk\")\n\np2 <- paczki[3:28, ] |> \n  ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Liczba osób\",\n    fill = \"TenYearCHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Impact of smoking for potential risk\")\n\np3 <- paczki[29:nrow(paczki), ] |> \n  ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Liczba osób\",\n    fill = \"TenYearCHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Impact of smoking for potential risk\")\n\nggsave(\"images/plots/impact_of_smoking_all.png\", p1)\nggsave(\"images/plots/impact_of_smoking_part1.png\", p2)\nggsave(\"images/plots/impact_of_smoking_part2.png\", p3)\n```\n\n::: panel-tabset\n##### Uwzględniając osoby niepalące\n\n![](images/plots/impact_of_smoking_all.png){fig-align=\"center\"}\n\n##### Osoby palące do 15 papierosów dziennie\n\n![](images/plots/impact_of_smoking_part1.png){fig-align=\"center\"}\n\n##### Osoby palące powyżej 15 papierosów dziennie\n\n![](images/plots/impact_of_smoking_part2.png){fig-align=\"center\"}\n:::\n\n```{r}\n#| label: Fraction_of_risk\n#| warning: false\npaczki_procenty <- badania |> \n  group_by(cigsPerDay) |> \n  mutate(cigsSum = n()) |> \n  subset(cigsSum > 20) |> \n  group_by(cigsPerDay, TenYearCHD) |> \n  summarise(n = n(), .groups = \"drop\") |> \n  group_by(cigsPerDay) |>\n  mutate(perc = n / sum(n) * 100)\n  \np1 <- paczki_procenty |>\n  ggplot(aes(x = factor(cigsPerDay),\n  y = perc,\n  fill = factor(TenYearCHD)\n)) +\n  geom_col() +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Procent\",\n    fill = \"Ten-Year CHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Fraction of risk group\")\n\nggsave(\"images/plots/fraction.png\", p1)\n\n```\n\n![](images/plots/fraction.png){fig-align=\"center\"}\n\n### Relacja pomiędzy zmienną `age`, a zmienną `cigsPerDay`\n\n```{r}\n#| label: smoking_byAge\n#| warning: false\np1 <- badania |> \n  ggplot(aes(y = age, color = currentSmoker)) +\n  geom_boxplot(lwd = 0.8) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  theme(axis.text.x = element_blank(),\n      axis.ticks.x = element_blank()) +\n  ggtitle(\"Distribution of age\")\n\np2 <- badania |> \n  ggplot(aes(x = age, color = currentSmoker)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() + \n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Distribution of age\")\n\nggsave(\"images/plots/smoking_byAge_1.png\", p1)\nggsave(\"images/plots/smoking_byAge_2.png\", p2)\n\n```\n\n::: panel-tabset\n##### Boxplot\n\n![](images/plots/smoking_byAge_1.png){fig-align=\"center\"}\n\n##### Density\n\n![](images/plots/smoking_byAge_2.png){fig-align=\"center\"}\n:::\n\n```{r}\n#| warning: false\npaczki_mean <- badania |> \n  group_by(cigsPerDay) |> \n  mutate(\n    cigsSum = n(),\n    sysBP_mean = mean(sysBP),\n    diaBP_mean = mean(diaBP)\n  ) |> \n  subset(cigsSum > 50)\n\np <- paczki_mean |> \n  ggplot(aes(x = cigsPerDay)) +\n  geom_line(aes(y = diaBP_mean), lwd = 1.2, color = \"#6AAED9\") +\n  geom_line(aes(y = sysBP_mean), lwd = 1.2, color = \"#F2A391\") +\n  theme_ipsum_rc() +\n  ggtitle(\"Mean values of sysBP and diaBP including smoking\")\n\nggsave(\"images/plots/mean_BP.png\", p)\n```\n\n![](images/plots/mean_BP.png){fig-align=\"center\"}\n\n```{r}\n#| label: concatenation\n#| warning: false\n\n p <- ggVennDiagram(list(\n  Udar = which(badania$prevalentStroke == \"Yes\"),\n  Nadcisnienie = which(badania$prevalentHyp == \"Yes\"),\n  Ryzyko = which(badania$TenYearCHD== \"Yes\")\n), set_size = 2.5) +\n  theme_minimal() + \n  scale_fill_gradient(low = \"#6AAED9\", high = \"#F2A391\") +\n  theme(legend.position = \"none\") +\n  ggtitle(\"Concatenation of dangerous diseases\")\n\nggsave(\"images/plots/concatenation.png\", p)\n\n```\n\n![](images/plots/concatenation.png){fig-align=\"center\"}\n\n### Model regresji logistycznej\n\n::DO PRZENIESIENIA !!!::\n\n```{r}\nstr(badania)\n\nlogit_model <- glm(TenYearCHD ~ age + sex + education + sysBP + diaBP + heartRate + BMI +\n                     totChol + glucose + diabetes + cigsPerDay + currentSmoker + BPMeds +\n                     prevalentStroke + prevalentHyp,\n                   data = badania,\n                   family = binomial(link = \"logit\"))\n\nsummary(logit_model)\n\nexp(coef(logit_model))\n\nstep_model <- step(logit_model, direction = \"both\")\nsummary(step_model)\n\nbadania$pred_prob <- predict(logit_model, type = \"response\")\nbadania$pred_class <- ifelse(badania$pred_prob > 0.2, 1, 0)\nbadania$pred_class <- factor(badania$pred_class, labels = c(\"No\", \"Yes\"))\n\nlibrary(pROC)\nroc_obj <- roc(badania$TenYearCHD, badania$pred_prob)\nplot(roc_obj)\nauc(roc_obj)\n\n\nlibrary(car)\nvif(logit_model)\n\ntable(Predicted = badania$pred_class, Actual = badania$TenYearCHD)\n\naccuracy <- mean(badania$pred_class == badania$TenYearCHD)\naccuracy\n```\n\n```{r}\n\n```\n\n<div>\n\n![](images/article/picture_2.png){style=\"margin-top: 25px;\" fig-align=\"center\"}\n\n</div>\n","srcMarkdownNoYaml":"\n\n## Rozpoczęcie\n\nKoniec z Lorem Ipsum. Test GitHub Desktop.\n\n## Biblioteki\n\n```{r}\n#| output: false\nlibrary(readr)\nlibrary(skimr)\nlibrary(knitr)\nlibrary(tidyverse)\nlibrary(corrplot)\nlibrary(ggcorrplot)\nlibrary(ggthemes)\nlibrary(tinythemes)\nlibrary(kableExtra)\nlibrary(rlang)\nlibrary(gridExtra)\nlibrary(patchwork)\nlibrary(mice)\nlibrary(psych)\nlibrary(VennDiagram)\nlibrary(ggVennDiagram)\n```\n\n## Zapoznanie z Danymi\n\nWczytanie pliku z rozszerzeniem `csv` do zmiennej o nazwie `data`.\n\n```{r}\ndata <- read.csv2(\"data/badania.csv\", sep=\",\")\n```\n\nSprawdźmy jak wyglądają nasze dane. Użyjemy do tego funkcji `head()` oraz `tail()` do podglądu kilku pierwszych i ostatnich obserwacji w naszym zbiorze danych. Pierwsze 10 obserwacji ma postać:\n\n```{r}\nhead(data)\n```\n\nNatomiast kilka ostatnich obserwcji nad którymi bedziemy pracować mają postać:\n\n```{r}\ntail(data)\n```\n\nSpradźmy rozmiary naszej ramki danych. W tym celu posłużymy się funkcjami `nrow()` oraz `ncol()`, które zawracają odpowiednio **liczbę wierszy** oraz **liczbę kolumn**.\n\n```{r}\nnrow(data)\nncol(data)\n```\n\nWidzimy że mamy ponad 4200 obserwacji i 16 zmiennych, które posłużą nam do stworzenia kilku modeli predykcyjnych i wyboru tego, który najlepiej będzie oceniał ryzyko zawału serca. Jest to naprawdę duży zasób danych, które mogą odpowiedzieć na wiele interesujących pytań. Nadszedł czas sprawdzić zmienne, które posiadamy. Użyjemy do tego funkcji `colnames().`\n\n```{r}\ncolnames(data)\n```\n\nOkazuje się, że nasz zbiór zawiera cenne informacje medyczne takie jak:\n\n1.  Tętno\n\n2.  BMI\n\n3.  Ciśnienie skurczowe i rozkurczowe\n\n4.  Poziom cholesterolu i glukozy\n\n5.  Informacje o tym, czy pacjent był palaczem, czy też nie\n\nDokładniej przyjrzymy się naszym zmiennym w dalszej części analizy zbioru danych. Wyjaśnimy dokładniej cechy poszczególnych kolumn zbioru danych oraz ich podstawowe statystyki. Czas sprawdzić podstawowe statystki dotyczące danych oraz to z jakimi typami danych będziemy pracować.\n\n```{r}\nskim(data)\n```\n\nTak jak widać na powyższym raporcie, zaczytując dane otrzymujemy 3 zmienne typu `character` oraz 13 zmiennych typu `numeric`. Taki podział ze względu na typ zmiennych nie jest odpowiedni. Wszystkie cechy typu `character` mają w naszym przypadku błędne formatowanie. Dodatkowo będziemy musieli dodać nowe typy zmiennych takie jak `boolean` oraz `factor`, aby móc szybko i praktycznie pracować z danymi. Odpowiedni wybór typów zmiennych jest podstawowym krokiem rozpczynając analizę zbioru danych. Zrobimy to w następujący sposób.\n\nbadania_sorted \\<- badania\\[order(is.na(badania\\$glucose), decreasing = TRUE), \\]\n\n```{r}\nbadania <- data |> \n  mutate(\n    sysBP = as.numeric(sysBP),\n    diaBP = as.numeric(diaBP),\n    BMI = as.numeric(BMI),\n    sex = factor(male, levels = c(0, 1), labels = c(\"Female\", \"Male\")),\n    education = factor(education, ordered = TRUE),\n    currentSmoker = factor(currentSmoker, labels = c(\"No\", \"Yes\")),\n    BPMeds = factor(BPMeds, labels = c(\"No\", \"Yes\")),\n    prevalentStroke = factor(prevalentStroke, labels = c(\"No\", \"Yes\")),\n    prevalentHyp = factor(prevalentHyp, labels = c(\"No\", \"Yes\")),\n    diabetes = factor(diabetes, labels = c(\"No\", \"Yes\")),\n    TenYearCHD = factor(TenYearCHD, labels = c(\"No\", \"Yes\"))\n  ) |> dplyr::select(-male)   \n\nbadania <- badania[order(is.na(badania$glucose), decreasing = TRUE), ]\n```\n\nW tym momencie wszystkie zmienne mają przypisane odpowiednie typy danych, co pozwoli zaoszczędzić czas podczas przeprowadzania obliczeń i analizy nad nimi. Dla wygody uporządkujemy teraz kolumny w odpowiedniej dla nas kolejności, tak aby informacje powiązane ze sobą były obok siebie (Np. zmienna `glucose` obok zmiennej `diabetes`)\n\n```{r}\nbadania <- dplyr::select(badania, c(1, 16, 2, 10, 11, 13, 12, 9, 14, 8, 4, 3, 5:7, 15))\nhead(badania)\n```\n\nZrobione. Teraz możemy przejść do wyjaśnienia zmiennych, aby było jasne z czym pracujemy oraz na czym możemy polegać podczas wykonywania analizy.\n\n## Opis i wyjaśnienie zmiennych\n\nPoniżej znajduje się tabela zawierająca wszystkie cechy wraz z ich wytłumaczeniem.\n\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| Zmienna           | Opis                                                                 | Jednostka                                                    | Typ         |\n+:=================:+:====================================================================:+:============================================================:+:===========:+\n| `age`             | Wiek (w latach)                                                      | Lata                                                         | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `sex`             | Płeć (1 - Mężczyzna, 0 - Kobieta)                                    | Brak                                                         | `factor`    |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `education`       | Wykształcenie                                                        | Brak                                                         | `factor`    |\n|                   |                                                                      |                                                              |             |\n|                   | (1 - Brak ukończonej szkoły średniej,                                |                                                              |             |\n|                   |                                                                      |                                                              |             |\n|                   | 2 - Ukończona szkoła średnia,                                        |                                                              |             |\n|                   |                                                                      |                                                              |             |\n|                   | 3 - Nieukończone studia lub ukończona szkoła zawodowa,               |                                                              |             |\n|                   |                                                                      |                                                              |             |\n|                   | 4 - Wykształcenie Wyższe)                                            |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `sysBP`           | Wartość ciśnienia skurczowego (Średnia ostatnich dwóch pomiarów)     | mmHg                                                         | `numerical` |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `diaBP`           | Wartość ciśnienia rozkurczowego (Średnia ostatnich dwóch pomiarów)   | mmHg                                                         | `numerical` |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `heartRate`       | Poziom tętna ()                                                      | Uderzeń na minutę                                            | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `BMI`             | Wartość współczynnika BMI                                            | $\\displaystyle \\frac{\\text{masa (kg)}}{\\text{wzrost (m)}^2}$ | `float`     |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `totalChol`       | Wartość poziomu cholesterolu ()                                      | $\\displaystyle \\frac{\\text{mg}}{\\text{dL}}$                  | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `glucose`         | Poziom glukozy we krwi ()                                            | $\\displaystyle \\frac{\\text{mg}}{\\text{dL}}$                  | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `diabetes`        | Fakt czy pacjent jest cukrzykiem\\                                    | brak                                                         | `factor`    |\n|                   | (1 - Tak, 0 - Nie)                                                   |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `cigsPerDay`      | Średnia liczba palonych dziennie papierosów                          | sztuki                                                       | `int`       |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `currentSmoker`   | Fakt czy pacjent jest palaczem\\                                      | brak                                                         | `factor`    |\n|                   | (1- Tak, 0 - Nie)                                                    |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `BMPmeds`         | Fakt czy pacjent leczy się na nadciśnienie krwi (1 - Tak, 0 - Nie)   | brak                                                         | `factor`    |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `prevalentStroke` | Wskazuje czy pacjent przeżył udar mózgu. (1 - Tak, 0 - Nie)          | brak                                                         | `factor`    |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `prevalentHyp`    | Wskazuje czy u pacjenta występowało nadciśnienie.\\                   | brak                                                         | `factor`    |\n|                   | (1 - Tak, 0 - Nie)                                                   |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n| `TenYearCHD`      | Wskazuje 10-letnie ryzyko wystąpienia choroby wieńcowej u pacjenta.\\ | brak                                                         | `factor`    |\n|                   | (1- Tak, 0-Nie)                                                      |                                                              |             |\n+-------------------+----------------------------------------------------------------------+--------------------------------------------------------------+-------------+\n\n## Uzupełnienie brakujących wartości\n\nZastanówmy się co zrobić z brakami danych w naszym zbiorze badań. Przedstawmy ilość wartości `NA` dla każdej zmiennej, w której takie wartości wystepują.\n\n```{r}\n#| label: NA_columns\n#| warning: false\nNA_count <- colSums(is.na(badania))[colSums(is.na(badania)) > 0] |> \n  data.frame()\n\nnames(NA_count) <- \"count\"\nNA_count$var = rownames(NA_count)\nrownames(NA_count) <- NULL\nNA_count <- select(NA_count, c(2,1))\n\np <- ggplot(NA_count, aes(x = var, y = count)) +\n  geom_col(show.legend = FALSE, fill = \"#6AAED9\") +\n  theme_ipsum_rc() +\n  geom_text(aes(label = count), vjust = -0.5) + \n  expand_limits(y = max(NA_count$count) * 1.1) +\n  labs(title = \"Liczba wartości NA w zmiennych\")\n\nggsave(\"images/plots/na_count_before.png\", p)\n```\n\n![](images/plots/na_count_before.png){fig-align=\"center\"}\n\n![](){fig-align=\"center\"}\n\nWidzimy, że mamy kilka zmiennych, które zawierają braki danych. Liczby wartośći `NA` w poszczególnych kolumnach są zazwyczaj mniejsze lub równe około 100, jedynym wyjątkiem z aż 388 wartościami `NA` jest zmienna `glucose` oznaczająca poziom glukozy we krwi pacjenta. Zanim uzupełnimy braki danych odpowiednią techniką spróbujemy dowiedzieć się w jaki sposób rozkładają się wartości `NA` tzn. czy braki te wystepują u różnych pacjentów, czy też jeden pacjent posiada brak informacji w więcej niż tylko jednej zmiennej.\n\n```{r}\n#| label: NA_rows\nNA_df <- data.frame(NA_w_wierszu = rowSums(is.na(badania))) |> \n  group_by(NA_w_wierszu) |> \n  summarise(liczebnosc = n())\n\np <- NA_df |> ggplot(aes(NA_w_wierszu, liczebnosc)) +\n  geom_col(show.legend = FALSE, fill = \"#6AAED9\") +\n  theme_ipsum_rc() +\n  geom_text(aes(label = liczebnosc), vjust = -0.5) + \n  expand_limits(y = max(NA_df$liczebnosc) * 1.1) +\n  labs(title = \"Liczba wartości NA w rekordach\")\n\nggsave(\"images/plots/NA_count_perRow.png\", p)\n```\n\n![](images/plots/NA_count_perRow.png){fig-align=\"center\"}\n\nDo uzupełniania wartości brakujących przyjeliśmy następującą metodykę:\n\n-   Rekordy posiadające dokładnie jedną wartość `NA` uzupełnimy na podstawie metody wielokrotnej imputacji\n\n-   Rekordy posiadające więcej niż jedną wartość `NA` odrzucamy, aby nie bazować na znacznie brakujących danych\n\nW zmiennej `badania` wybieramy te wiersze, w których znajduje się co najwyżej jedna wartość `NA`.\n\n```{r}\nbadania <- badania[rowSums(is.na(badania)) <= 1, ]\n```\n\n```{r}\n#| warning: false\n#| echo: false\nNA_count <- colSums(is.na(badania))[colSums(is.na(badania)) > 0] |> \n  data.frame()\n\nnames(NA_count) <- \"count\"\nNA_count$var = rownames(NA_count)\nrownames(NA_count) <- NULL\nNA_count <- select(NA_count, c(2,1))\n\np <- ggplot(NA_count, aes(x = var, y = count)) +\n  geom_col(show.legend = FALSE, fill = \"#6AAED9\") +\n  theme_ipsum_rc() +\n  geom_text(aes(label = count), vjust = -0.5) + \n  expand_limits(y = max(NA_count$count) * 1.1) +\n  labs(title = \"Liczba wartości NA w zmiennych\")\n\nggsave(\"images/plots/na_count_after.png\", p)\n```\n\nWizualizacja liczby brakujących danych ma postać:\n\n::: panel-tabset\n### Po wczytaniu danych\n\n![](images/plots/na_count_before.png){fig-align=\"center\"}\n\n### Po wstępnym usunięciu danych\n\n![](images/plots/na_count_after.png){fig-align=\"center\"}\n:::\n\nW tym momencie przeprowadzimy proces uzupełniania zmiennych przy pomocy funkcji `mice` - metodą wielokrotnej imputacji. Braki danych znajdują się w kolumnach o różnych typach zmiennych.\n\n**Zmienne kategoryczne:**\n\n-   `BPMeds`\n\n-   `education`\n\n**Zmienne numeryczne:**\n\n-   `BMI`\n\n-   `cigsPerDay`\n\n-   `glucose`\n\n-   `heartRate`\n\n-   `totChol`\n\nZe względu na typy zmiennych oraz rozkłady, jakimi te zmienne się charakteryzują decydujemy się użyć metodę `pmm` (Predictive Mean Matching) dla zmiennych numerycznych oraz metodę `logreg` dla `BPMeds` oraz `polr` dla `education`.\n\n**Uzasadnienie:** `pmm` zachowuje rozkłady i wybiera realne obserwacje jako wartości wejściowe, co jest szczególnie ważne przy zmiennych o rozkładzie ciągłym. Dla zmiennych kategorycznych używamy odpowiednich regresji klasyfikacyjnych w zależności od cech zmiennej.\n\n```{r}\n#| output: false\nstatystyki_przed <- describe(badania[NA_count$var])\nmetody <- make.method(badania)\n\nmetody[\"BPMeds\"] <- \"logreg\"        #\nmetody[\"education\"] <- \"polr\" \nmetody[\"BMI\"] <- \"pmm\"\nmetody[\"cigsPerDay\"] <- \"pmm\"\nmetody[\"glucose\"] <- \"pmm\"\nmetody[\"heartRate\"] <- \"pmm\"\nmetody[\"totChol\"] <- \"pmm\"\nuzupelnienia <- mice(badania,\n                m = 5,\n                method = metody,\n                seed = 2025)\nbadania <- complete(uzupelnienia)\nstatystyki_po <- describe(badania[NA_count$var])\n\n```\n\nPo uzupełnieniu brakujących wartości porównajmy statystyki dla naszych zmiennych.\n\n::: panel-tabset\n### Przed uzupełnieniem danych\n\n```{r}\nround(data.frame(t(statystyki_przed))[c(2:9,10:12), ], 3)\n```\n\n### Po uzupełnieniu danych\n\n```{r}\nround(data.frame(t(statystyki_po))[c(2:9,10:12), ], 3)\n```\n:::\n\nSprawdzając podstawowe statystki widzimy, że uzupełniając dane zachowaliśmy ich strukturę. Różnica pomiędzy wartościami statystyk polega najczęściej na zmianie części tysięcznych lub setnych, więc wartości `NA` zostały bardzo dobrze odwzorowane. Teraz możemy wykonać analizę wstępną naszego zbioru danych, aby następnie przejść do stworzenia modeli predykcyjnych oraz głębszej analizy. Ostatnim punktem pracy nad modyfikowaniem naszych danych jest zapisanie oszyszczonych i uzupełnionych danych do pliku `.csv`, który wykorzystamy m. in. podczas tworzenia modeli w języku programowania `R` lub `python.`\n\n```{r}\nwrite.csv(badania, file = \"badania.csv\")\n```\n\n## Analiza Danych\n\nW trakcie wykonowynia wizualizacji bedziemy posługiwać się pacjentami, których traktujemy jako tych, którzy nie są w grupie zagrożenia oraz tych, którzy w tej grupie są. Dla ułatwienia przeprowadzania operacji stworzymy dwie ramki danych `zdrowi` oraz `chorzy` aby odwoływać się do tych grup bezpośrednio.\n\n```{r}\nbadania <- mutate(badania, ID = 1:nrow(badania))\nzdrowi <- badania |> \n  subset(TenYearCHD == \"No\")\n\nchorzy <- badania |> \n  subset(TenYearCHD == \"Yes\")\n```\n\n### Funkcja Tworzenia Wykresów\n\n```{r}\n#| warning: false\nzmienna_wykres <- function(dane, typ_zmiennej, typ_wykresu) {\n  my_plots = list()\n  if (typ_zmiennej == \"kategoryczna\") {\n    dane <- dane |> \n      dplyr::select(where(is.factor))\n  } else if (typ_zmiennej == \"numeryczna\") {\n    dane <- dane |> \n      dplyr::select(where(is.numeric))\n  } else {\n    # nic nie robimy\n  }\n  \n  for (i in 1:ncol(dane)) {\n    kolumna <- colnames(dane)[i]\n    if (typ_wykresu == \"barplot\") {\n    p <- ggplot(dane, aes(x = !!sym(kolumna), fill = !!sym(kolumna))) +\n      geom_bar(show.legend = FALSE, width = 0.6) +\n      theme_ipsum_rc() +\n      ggtitle(kolumna) +\n      scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\"))\n      \n    \n    } else if (typ_wykresu == \"pie\") {\n      p <- dane %>%\n        dplyr::count(!!sym(kolumna)) %>%\n        ggplot(aes(x = \"\", y = n, fill = !!sym(kolumna))) +\n        geom_bar(stat = \"identity\", width = 1, color = \"white\") +\n        coord_polar(theta = \"y\") +\n        theme_void() +\n        ggtitle(kolumna) +\n        scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\"))\n      \n    } else if (typ_wykresu == \"histogram\") {\n      p <- ggplot(dane, aes(x = !!sym(kolumna))) +\n        geom_histogram(bins = 20, show.legend = FALSE, fill = \"#6AAED9\", color = \"black\") +\n        theme_ipsum_rc() +\n        ggtitle(kolumna)\n        \n      \n    } else if (typ_wykresu == \"violin\") {\n      p <- ggplot(dane, aes(x = \"\", y = !!sym(kolumna), fill = \"#6AAED9\")) +\n        geom_violin(show.legend = FALSE) +\n        theme_ipsum_rc() +\n        ggtitle(kolumna) +\n        scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\"))\n    } else {\n      next  # pomiń jeśli nieznany typ wykresu\n    }\n    my_plots[[i]] <- p\n  } \n\n  \ngotowy_wykres_1 <- (my_plots[[1]] + my_plots[[2]]) / (my_plots[[3]] + my_plots[[4]]) \ngotowy_wykres_2 <- (my_plots[[5]] + my_plots[[6]]) / (my_plots[[7]] + my_plots[[8]])\nggsave(paste0(\"images/plots/\", typ_zmiennej, \"_\", typ_wykresu, \"1.png\"), gotowy_wykres_1)\nggsave(paste0(\"images/plots/\", typ_zmiennej, \"_\", typ_wykresu, \"2.png\"), gotowy_wykres_2)\n}\n```\n\nTak zbudowana funkcja pozwala nam na generowanie wykresów w zależności od:\n\n-   Typu zmiennej\n\n-   Typu wykresu\n\nDzięki temu możemy szybko i prosto uzyskać wiele wizualizacji na temat interesujących nas zmiennych. Zdecydowaliśmy się przedstawić nasze zmienne z podziałem na:\n\n1.  Zmienne typu kategorycznego, przedstawiając liczebność ogólną oraz względem siebie, za pomocą wykresów `barplot` oraz `pie`.\n\n2.  Zmienne typu numerycznego, przedstawiając gęstośc oraz rozkład zmiennej, za pomocą wykresów `violin` oraz `histogram`\n\nPoniżej przedstawiamy efekty naszej pracy, gdzie przeanalizujemy poszczególne zmienne.\n\n### Zmienne Kategoryczne\n\n```{r}\n#| label: Kategoryczne_Wstep\nzmienna_wykres(badania, \"kategoryczna\", \"barplot\")\nzmienna_wykres(badania, \"kategoryczna\", \"pie\")\n```\n\n::: panel-tabset\n#### Barplot\n\n![](images/plots/kategoryczna_barplot1.png){fig-align=\"center\"}\n\n![](images/plots/kategoryczna_barplot2.png){fig-align=\"center\"}\n\n#### Pie\n\n![](images/plots/kategoryczna_pie1.png){fig-align=\"center\"}\n\n![](images/plots/kategoryczna_pie2.png){fig-align=\"center\"}\n:::\n\n**Po przeanalizowaniu wykresów nasuwają się nastepujące wnioski:**\n\n-   Analizujemy zbiór ponad 4.000 osób, w którym kobiety lekko przewyższają swoją liczebnością mężczyzn.\n\n-   Wraz z poziomem wykształcenia zmniejsza się liczba osób w danej kategorii wykształcenia. Osób bez ukończonej szkoły średniej jest około 1750, stopniowo zmniejszając się do 500 osób z wykształceniem wyższym. Wśród naszych danych przeważają osoby bez wykształcenia lub jedynie z wykształceniem średnim.\n\n-   Podział na osoby palące i niepalące jest jednakowy. Obie grupy zawierają około 2.000 osób.\n\n-   Grupy osób w których skład wchodzą osoby z cukrzycą, osoby leczące nadciśnienie krwi oraz osoby, które przeżyły udar mózgu są bardzo nieliczne. Ograniczają się maksymalnie do kilkudziesięciu osób. Mimo wszystko osoby te mogą dostarczyć wiele cennych informacji w dalszej analizie ryzyka choroby serca.\n\n-   Bazujemy na danych w których stosunek liczby osób, u których nie występowało nadciśnienie do liczby osób u których nadciśnienie występowało jest równe w przybliżeniu 2:1.\n\n-   Zmienna predykcyjna `TenYearCHD` przewiduje potencjalne ryzyko choroby serca dla ponad 500 osób, co stanowi około 12.5% liczby wszystkich badanych. Oznacza to, że średnio co 8 badana osoba jest kwalifikowana w grupie ryzyka.\n\n### Zmienne numeryczne\n\n```{r}\n#| label: Numeryczne_Wstep\nzmienna_wykres(badania, \"numeryczna\", \"violin\")\nzmienna_wykres(badania, \"numeryczna\", \"histogram\")\n```\n\n::: panel-tabset\n#### Violin\n\n![](images/plots/numeryczna_violin1.png){fig-align=\"center\"}\n\n![](images/plots/numeryczna_violin2.png){fig-align=\"center\"}\n\n#### Histogram\n\n![](images/plots/numeryczna_histogram1.png){fig-align=\"center\"}\n\n![](images/plots/numeryczna_histogram2.png){fig-align=\"center\"}\n:::\n\n**Po przeanalizowaniu wykresów nasuwają się nastepujące wnioski:**\n\n-   Badamy grupę osób, w której większość osób ma od 35 do 65 lat.\n\n-   Ciśnienie rozkurczowe zawiera się głównie w przedziale \\<70; 90\\> natomiast ciśnienie skurczowe w przedziale \\<115; 140\\>\n\n-   Najczęściej badane osoby posiadają tętno serca na poziomie 70-80 uderzeń na minutę.\n\n-   Interesujący jest rozkład zmiennej `cigsPerDay`. Widać znaczący wzrost wystąpień osób palących 20 papierosów dziennie. Dokładnie taka liczba papierosów znajduje się w pojedyńczej paczce. Możemy zatem przyjąć, że dla wielu osób codziennym nawykiem jest wypalenie dokładnie całej paczki w trakcie dnia.\n\n-   Zmienne cechują się niesymetrycznym rozkładem, dodatkowo zaburzone są rozkłady dla zmiennej `age` oraz `cigsPerDay`.\n\n-   Większość zmiennych jest prawostronnie asymetryczna, ciężko mówić o normalności rozkładów ze względu na obecność wartości odstających, które są powszechne wśród danych medycznych.\n\n### Zależności pomiędzy zmiennymi\n\nWśród naszych zmiennych mogą istnieć zależności liniowe. W celu sprawdzenia tego faktu stworzymy macierz korelacji, aby przedstawić jak wygląda korelacja pomiędzy poszczególnymi zmiennymi. Posłużymy się w tym celu zmiennymi numerycznymi.\n\n```{r}\n#| label: Korelacja\ncor_mat <- badania %>% \n  select(where(is.numeric)) %>% \n  cor()\n\np <- ggcorrplot(\n    cor_mat,\n    lab = TRUE,               \n    type = \"lower\",           \n    hc.order = TRUE,          #\n    outline.col = \"white\",\n    ggtheme = ggplot2::theme_minimal(),\n    colors = c(\"#6AAED9\", \"white\", \"#F25041\") \n) + ggtitle(\"Macierz Korelacji\")\nggsave(\"images/plots/korelacja.jpg\", p)\n```\n\n![](images/plots/korelacja.jpg){fig-align=\"center\"}\n\nWidzimy, że istnieje duża korelacja równa 0.78 pomiędzy zmiennymi `sysBP` oraz `diaBP`. Nie powinno nas to specjalnie dziwić, ponieważ wartość ciśnienia rozkurczowego ma bezpośredni wypływ na wartość ciśnienia skurczowego. Dodatkowo poziom BMI a co za tym idzie - nasza waga ma wpływ na wartośc ciśnienia rozkurczowego oraz skurczowego. W oczy może rzucić nam się również wartość korelacji na poziomie -0.19 między zmienną `age` oraz `cigsPerDay`, która oznacza, że wraz z wiekiem palimy coraz mniej papierosów dziennie. Nie są to jednak wysokie wartości współczynnika korelacji, więc nie możemy powiedzieć, że pomiędzy tymi zmiennymi istnieje statystycznie istotna korelacja. Możemy jedna informacje traktować jako wskazówki podczas dalszej analizy i zgłębić analizę w kierunku tych zmiennych.\n\n### Relacja pomiędzy diaBP oraz sysBP\n\nSprawdźmy jak będzie wyglądać zestawienie wartości ciśnienia skurczowego od wartości ciśnienia rozkurczowego, dodatkowo dodamy kilka czynników, które dotakowo pokażą zależności pomiędzy większą liczbą zmiennych.\n\n```{r}\n#| label: sysBP_wzgledem_diaBP\np1 <- ggplot(badania, aes(x = diaBP, y = sysBP, color = sex, shape = sex)) +\n  geom_point() +\n  theme_ipsum_rc() +\n  ggtitle(\"sysBP ~ diaBP\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\nggsave(\"images/plots/sysBP_wzgledem_diaBP.jpg\", p1)\n\n```\n\n![](images/plots/sysBP_wzgledem_diaBP.jpg){fig-align=\"center\"}\n\nZe względu na dużą liczbę rekordów, punkty zaznaczone na wykresie typu `scatter plot` tworzą masywną chmurę punktów, utrudniając interpretację. Aby ułatwić analizę na podstawie wykresu posłużymy się wykresami gęstości porównując dodatkowo wpływ innych zmiennych na wartość ciśnienia rozkurczowego oraz skurczowego.\n\n### Ciśnienie rozkurczowe\n\n```{r}\n#| label: diaBP\np1 <- ggplot(badania, aes(x = diaBP, color = sex)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of diaBP by Sex\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  theme(legend.position = \"bottom\")\n\np2 <- ggplot(badania, aes(x = diaBP, color = education)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of diaBP by Education Level\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\np3 <- ggplot(badania, aes(x = diaBP, color = currentSmoker)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of diaBP by Smoking\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\nggsave(\"images/plots/diaBP_bySex.jpg\", p1)\nggsave(\"images/plots/diaBP_byEducation.jpg\", p2)\nggsave(\"images/plots/diaBP_byCurrentSmoker.jpg\", p3)\n```\n\n::: panel-tabset\n#### Względem zmiennej sex\n\n![](images/clipboard-1376958334.jpeg)\n\n#### Względem zmiennej education\n\n![](images/plots/diaBP_byEducation.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej currentSmoker\n\n![](images/plots/diaBP_byCurrentSmoker.jpg){fig-align=\"center\"}\n:::\n\n::analiza::\n\n### Ciśnienie skurczowe\n\nAnalogicznie postepujemy dla zmiennej `sysBP`. Pamiętamy że omawiane zmienne są silnie ze sobą skorelowane, więc spodziewamy się podobnych rezultatów.\n\n```{r}\n#| label: sysBP\np1 <- ggplot(badania, aes(x = sysBP, color = sex)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of sysBP by Sex\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  theme(legend.position = \"bottom\")\n\np2 <- ggplot(badania, aes(x = sysBP, color = education)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of sysBP by Education Level\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\np3 <- ggplot(badania, aes(x = sysBP, color = currentSmoker)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  ggtitle(\"Distribution of sysBP by Smoking\") +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  theme(legend.position = \"bottom\")\n\nggsave(\"images/plots/sysBP_bySex.jpg\", p1)\nggsave(\"images/plots/sysBP_byEducation.jpg\", p2)\nggsave(\"images/plots/sysBP_byCurrentSmoker.jpg\", p3)\n```\n\n::: panel-tabset\n#### Względem zmiennej sex\n\n![](images/plots/sysBP_bySex.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej education\n\n![](images/plots/sysBP_byEducation.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej currentSmoker\n\n![](images/plots/sysBP_byCurrentSmoker.jpg){fig-align=\"center\"}\n:::\n\nanaliza::\n\n### Zakres pracy serca, a ryzyko zawału\n\n```{r}\n#| label: Pulse_pressure\n#| warning: false\np1 <- badania |> \n  mutate(range_diff = sysBP - diaBP) |> \n  arrange(range_diff) |> \n  ggplot(aes(x = range_diff, color = TenYearCHD)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  labs(title = \"Pulse pressure distribution\", x = \"sysBP - diaBP\")\n\np2 <- badania |> \n  mutate(range_diff = sysBP - diaBP) |> \n  arrange(range_diff) |> \n  ggplot(aes(x = range_diff, color = prevalentHyp)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  labs(title = \"Pulse pressure distribution\", x = \"sysBP - diaBP\")\n\np3 <- badania |> \n  mutate(range_diff = sysBP - diaBP) |> \n  arrange(range_diff) |> \n  ggplot(aes(x = range_diff, color = diabetes)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\", \"#2C5DBF\", \"#F25041\")) +\n  labs(title = \"Pulse pressure distribution\", x = \"sysBP - diaBP\")\n\nggsave(\"images/plots/pulse_pressure_1.jpg\", p1)\nggsave(\"images/plots/pulse_pressure_2.jpg\", p2)\nggsave(\"images/plots/pulse_pressure_3.jpg\", p3)\n```\n\n::: panel-tabset\n#### Względem zmiennej TenYearCHD\n\n![](images/plots/pulse_pressure_1.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej prevalentHyp\n\n![](images/plots/pulse_pressure_2.jpg){fig-align=\"center\"}\n\n#### Względem zmiennej diabetes\n\n![](images/plots/pulse_pressure_3.jpg){fig-align=\"center\"}\n:::\n\n:analiza::\n\n### Ciśnienie serca jako przyczyna zawału serca\n\n#### Z uzględnieniem płci\n\n```{r}\n#| label: Cisnienie_wzgledem_ryzyka\n#| warning: false\np1 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = sysBP, color = sex)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) + \n  ggtitle(\"Value of sysBP by Sex\")\n\np2 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = diaBP, color = sex)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n   ggtitle(\"Value of diaBP by Sex\")\n\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_bySex_1.png\", p1)\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_bySex_2.png\", p2)\n```\n\n::: panel-tabset\n##### Ciśnienie skurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_bySex_1.png){fig-align=\"center\"}\n\n##### Ciśnienie rozkurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_bySex_2.png){fig-align=\"center\"}\n:::\n\n#### Z uwzględnieniem nadciśnienia\n\n```{r}\n#| label: Cisnienie_wzgledem_ryzyka_2\np1 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = sysBP, color = prevalentHyp)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) + \n  ggtitle(\"Value of sysBP by the fact of prevalent Hypothesis\")\n\np2 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = diaBP, color = prevalentHyp)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n   ggtitle(\"Value of diaBP by the fact of prevalent Hypothesis\")\n\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_1.png\", p1)\nggsave(\"images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_2.png\", p2)\n```\n\n::: panel-tabset\n##### Ciśnienie skurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_1.png){fig-align=\"center\"}\n\n##### Ciśnienie rozkurczowe\n\n![](images/plots/cisnienie_wzlgedem_ryzyka_byprevHyp_2.png){fig-align=\"center\"}\n:::\n\n#### Rozkład wartości ciśnienia\n\n```{r}\n#| label: rozklad_cisnienia\n#| warning: false\n\np1 <- badania |> \n  ggplot(aes(x = sysBP, color = TenYearCHD)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Distribution of sysBP including risk of disease\")\n\np2 <- badania |> \n  ggplot(aes(x = diaBP, color = TenYearCHD)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Distribution of diaBP including risk of disease\")\n\nggsave(\"images/plots/rozklad_cisnienia_1.png\", p1)\nggsave(\"images/plots/rozklad_cisnienia_2.png\", p2)\n```\n\n::: panel-tabset\n##### Ciśnienie skurczowe\n\n![](images/plots/rozklad_cisnienia_1.png){fig-align=\"center\"}\n\n##### Ciśnienie rozkurczowe\n\n![](images/plots/rozklad_cisnienia_2.png){fig-align=\"center\"}\n:::\n\n### Analiza wartości tętna\n\n```{r}\n#| label: poziom_tetna\n#| warning: false\nbins <- seq(min(badania$heartRate), max(badania$heartRate), length.out = 16)\n\nhist_data <- badania %>%\n  mutate(bin = cut(heartRate, breaks = bins, include.lowest = TRUE)) %>%\n  count(TenYearCHD, bin) %>%\n  mutate(count_adj = ifelse(TenYearCHD == \"No\", n, -n))\n\n\np <- hist_data |> \n  ggplot(aes(x = bin, y = count_adj, fill = TenYearCHD)) +\n  geom_col(position = \"identity\") +\n  labs(y = \"Liczebność w grupie\", x = \"Przedziały\") +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\"))\n  \nggsave(\"images/plots/poziom_tetna.png\", p)\n```\n\n![](images/plots/poziom_tetna.png){fig-align=\"center\"}\n\n#### Rozkład zmiennej\n\n```{r}\n#| label: rozklad_tetna_gestosc\n#| warning: false\np <- badania |> \n  ggplot(aes(x = heartRate)) +\n  geom_density(color = \"#6AAED9\", lwd = 1.2) +\n  stat_function(\n    fun = dnorm,\n    args = list(mean = mean(badania$heartRate), sd = sd(badania$heartRate)),\n    linewidth = 1.2,\n    col = \"#F25041\"\n  ) +\n  theme_ipsum_rc()\n\nggsave(\"images/plots/rozklad_tetna_gestosc.png\", p)\n```\n\n![](images/plots/rozklad_tetna_gestosc.png){fig-align=\"center\"}\n\n#### Poziom tętna ze względu na inne zmienne\n\n```{r}\n#| label: heartRate_by\n#| warning: false\np1 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = heartRate, color = sex)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"heartRate ~ TenYearCHD\")\n\np2 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = heartRate, color = currentSmoker)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"heartRate ~ TenYearCHD\")\n\np3 <- badania |> \n  ggplot(aes(x = TenYearCHD, y = heartRate, color = BPMeds)) +\n  geom_boxplot() +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"heartRate ~ TenYearCHD\")\n\nggsave(\"images/plots/heartRate_bySex.png\", p1)\nggsave(\"images/plots/heartRate_bycurrentSmoker.png\", p2)\nggsave(\"images/plots/heartRate_byBPMeds.png\", p3)\n```\n\n::: panel-tabset\n##### sex\n\n![](images/plots/heartRate_bySex.png){fig-align=\"center\"}\n\n##### currentSmoker\n\n![](images/plots/heartRate_bycurrentSmoker.png){fig-align=\"center\"}\n\n##### BPMeds\n\n![](images/plots/heartRate_byBPMeds.png){fig-align=\"center\"}\n:::\n\n### Leki na nadciśnienie i ich skutek\n\n```{r}\n#| label: leki_nadcisnienie\n#| warning: false\np1 <- badania |> \n  ggplot(aes(x = sysBP, color = BPMeds)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\"))\n\np2 <- badania |> \n  ggplot(aes(x = diaBP, color = BPMeds)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\"))\n\nggsave(\"images/plots/leki_nadcisnienie_rozklad1.png\", p1)\nggsave(\"images/plots/leki_nadcisnienie_rozklad2.png\", p2)\n```\n\n::: panel-tabset\n#### Ciśnienie skurczowe\n\n![](images/plots/leki_nadcisnienie_rozklad1.png){fig-align=\"center\"}\n\n#### Ciśnienie rozkurczowe\n\n![](images/plots/leki_nadcisnienie_rozklad2.png){fig-align=\"center\"}\n:::\n\n### Skutki palenia na układ krążenia\n\n```{r}\nosoby_palace <- badania |> \n  subset(currentSmoker == \"Yes\")\n\nosoby_niepalace <- badania |> \n  subset(cigsPerDay == 0)\n\ndata.frame(osoby_palace = nrow(osoby_palace),\n           osoby_niepalace = nrow(osoby_niepalace),\n           row.names = \"Liczba osób\"\n           )\n```\n\n#### Podział pacjentów ze względu na palenie\n\n```{r}\n#| warning: false\n\np1 <- badania |> \n  ggplot(aes(x = currentSmoker, fill = currentSmoker)) +\n  geom_bar(fill = c(\"#6AAED9\", \"#F2A391\"), width = 0.3, color = \"black\") +\n  theme_ipsum_rc() +\n  ggtitle(\"Smokers vs No Smokers\")\n\np2 <- badania |> \n  ggplot(aes(x = currentSmoker, fill = sex)) +\n  geom_bar(position = position_dodge(width = 0.7), color = \"black\",  width = 0.6) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Smoking including sex\")\n\np3 <- badania |> \n  ggplot(aes(x = currentSmoker, fill = TenYearCHD)) +\n  geom_bar(position = position_dodge(width = 0.7), color = \"black\",  width = 0.6) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Smoking including potential risk of disease\")\n\nggsave(\"images/plots/number_of_smokers.png\", p1)\nggsave(\"images/plots/number_of_smokers_bySex.png\", p2)\nggsave(\"images/plots/number_of_smokers_byTenYearCHD.png\", p3)\n```\n\n::: panel-tabset\n##### Distribution by Smoking Status\n\n![](images/plots/number_of_smokers.png){fig-align=\"center\"}\n\n##### Number of Smokers by sex\n\n![](images/plots/number_of_smokers_bySex.png){fig-align=\"center\"}\n\n##### Number of smokers including disease risk\n\n![](images/plots/number_of_smokers_byTenYearCHD.png){fig-align=\"center\"}\n:::\n\n#### Nawyki palenia papierosów\n\n```{r}\n#| label: cigs_per_Day\n#| warning: false\n\np1 <- badania |> \n  ggplot(aes(x = cigsPerDay)) +\n  geom_bar(fill = \"#6AAED9\") +\n  theme_ipsum_rc()\n\n\np2 <- osoby_palace |> \n  ggplot(aes(x = cigsPerDay)) +\n  geom_bar(fill = \"#6AAED9\") +\n  theme_ipsum_rc()\n\nggsave(\"images/plots/cigsPerDay1.png\", p1)\nggsave(\"images/plots/cigsPerDay2.png\", p2)\n```\n\n::: panel-tabset\n##### Uwzględniając wszystkich pacjentów\n\n![](images/plots/cigsPerDay1.png){fig-align=\"center\"}\n\n##### Uwzględnając tylko osoby palące\n\n![](images/plots/cigsPerDay2.png){fig-align=\"center\"}\n:::\n\n#### Wpływ poziomu palenia na ryzyko choroby\n\n```{r}\n#| label: impact_of_smkoing\n#| warning: false\npaczki <- badania |> \n  group_by(cigsPerDay, TenYearCHD) |> \n  summarise(n = n(), .groups = \"drop\") |> \n  group_by(cigsPerDay) |>\n  mutate(perc = n / sum(n) * 100)\n\np1 <- paczki[1:28, ] |> \n  ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Liczba osób\",\n    fill = \"TenYearCHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Impact of smoking for potential risk\")\n\np2 <- paczki[3:28, ] |> \n  ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Liczba osób\",\n    fill = \"TenYearCHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Impact of smoking for potential risk\")\n\np3 <- paczki[29:nrow(paczki), ] |> \n  ggplot(aes(x = factor(cigsPerDay), y = n, fill = factor(TenYearCHD))) +\n  geom_col(position = position_dodge(width = 0.8)) +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Liczba osób\",\n    fill = \"TenYearCHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Impact of smoking for potential risk\")\n\nggsave(\"images/plots/impact_of_smoking_all.png\", p1)\nggsave(\"images/plots/impact_of_smoking_part1.png\", p2)\nggsave(\"images/plots/impact_of_smoking_part2.png\", p3)\n```\n\n::: panel-tabset\n##### Uwzględniając osoby niepalące\n\n![](images/plots/impact_of_smoking_all.png){fig-align=\"center\"}\n\n##### Osoby palące do 15 papierosów dziennie\n\n![](images/plots/impact_of_smoking_part1.png){fig-align=\"center\"}\n\n##### Osoby palące powyżej 15 papierosów dziennie\n\n![](images/plots/impact_of_smoking_part2.png){fig-align=\"center\"}\n:::\n\n```{r}\n#| label: Fraction_of_risk\n#| warning: false\npaczki_procenty <- badania |> \n  group_by(cigsPerDay) |> \n  mutate(cigsSum = n()) |> \n  subset(cigsSum > 20) |> \n  group_by(cigsPerDay, TenYearCHD) |> \n  summarise(n = n(), .groups = \"drop\") |> \n  group_by(cigsPerDay) |>\n  mutate(perc = n / sum(n) * 100)\n  \np1 <- paczki_procenty |>\n  ggplot(aes(x = factor(cigsPerDay),\n  y = perc,\n  fill = factor(TenYearCHD)\n)) +\n  geom_col() +\n  labs(\n    x = \"Cigarettes per Day\",\n    y = \"Procent\",\n    fill = \"Ten-Year CHD\"\n  ) +\n  theme_ipsum_rc() +\n  scale_fill_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Fraction of risk group\")\n\nggsave(\"images/plots/fraction.png\", p1)\n\n```\n\n![](images/plots/fraction.png){fig-align=\"center\"}\n\n### Relacja pomiędzy zmienną `age`, a zmienną `cigsPerDay`\n\n```{r}\n#| label: smoking_byAge\n#| warning: false\np1 <- badania |> \n  ggplot(aes(y = age, color = currentSmoker)) +\n  geom_boxplot(lwd = 0.8) +\n  theme_ipsum_rc() +\n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  theme(axis.text.x = element_blank(),\n      axis.ticks.x = element_blank()) +\n  ggtitle(\"Distribution of age\")\n\np2 <- badania |> \n  ggplot(aes(x = age, color = currentSmoker)) +\n  geom_density(lwd = 1.2) +\n  theme_ipsum_rc() + \n  scale_color_manual(values = c(\"#6AAED9\", \"#F2A391\")) +\n  ggtitle(\"Distribution of age\")\n\nggsave(\"images/plots/smoking_byAge_1.png\", p1)\nggsave(\"images/plots/smoking_byAge_2.png\", p2)\n\n```\n\n::: panel-tabset\n##### Boxplot\n\n![](images/plots/smoking_byAge_1.png){fig-align=\"center\"}\n\n##### Density\n\n![](images/plots/smoking_byAge_2.png){fig-align=\"center\"}\n:::\n\n```{r}\n#| warning: false\npaczki_mean <- badania |> \n  group_by(cigsPerDay) |> \n  mutate(\n    cigsSum = n(),\n    sysBP_mean = mean(sysBP),\n    diaBP_mean = mean(diaBP)\n  ) |> \n  subset(cigsSum > 50)\n\np <- paczki_mean |> \n  ggplot(aes(x = cigsPerDay)) +\n  geom_line(aes(y = diaBP_mean), lwd = 1.2, color = \"#6AAED9\") +\n  geom_line(aes(y = sysBP_mean), lwd = 1.2, color = \"#F2A391\") +\n  theme_ipsum_rc() +\n  ggtitle(\"Mean values of sysBP and diaBP including smoking\")\n\nggsave(\"images/plots/mean_BP.png\", p)\n```\n\n![](images/plots/mean_BP.png){fig-align=\"center\"}\n\n```{r}\n#| label: concatenation\n#| warning: false\n\n p <- ggVennDiagram(list(\n  Udar = which(badania$prevalentStroke == \"Yes\"),\n  Nadcisnienie = which(badania$prevalentHyp == \"Yes\"),\n  Ryzyko = which(badania$TenYearCHD== \"Yes\")\n), set_size = 2.5) +\n  theme_minimal() + \n  scale_fill_gradient(low = \"#6AAED9\", high = \"#F2A391\") +\n  theme(legend.position = \"none\") +\n  ggtitle(\"Concatenation of dangerous diseases\")\n\nggsave(\"images/plots/concatenation.png\", p)\n\n```\n\n![](images/plots/concatenation.png){fig-align=\"center\"}\n\n### Model regresji logistycznej\n\n::DO PRZENIESIENIA !!!::\n\n```{r}\nstr(badania)\n\nlogit_model <- glm(TenYearCHD ~ age + sex + education + sysBP + diaBP + heartRate + BMI +\n                     totChol + glucose + diabetes + cigsPerDay + currentSmoker + BPMeds +\n                     prevalentStroke + prevalentHyp,\n                   data = badania,\n                   family = binomial(link = \"logit\"))\n\nsummary(logit_model)\n\nexp(coef(logit_model))\n\nstep_model <- step(logit_model, direction = \"both\")\nsummary(step_model)\n\nbadania$pred_prob <- predict(logit_model, type = \"response\")\nbadania$pred_class <- ifelse(badania$pred_prob > 0.2, 1, 0)\nbadania$pred_class <- factor(badania$pred_class, labels = c(\"No\", \"Yes\"))\n\nlibrary(pROC)\nroc_obj <- roc(badania$TenYearCHD, badania$pred_prob)\nplot(roc_obj)\nauc(roc_obj)\n\n\nlibrary(car)\nvif(logit_model)\n\ntable(Predicted = badania$pred_class, Actual = badania$TenYearCHD)\n\naccuracy <- mean(badania$pred_class == badania$TenYearCHD)\naccuracy\n```\n\n```{r}\n\n```\n\n<div>\n\n![](images/article/picture_2.png){style=\"margin-top: 25px;\" fig-align=\"center\"}\n\n</div>\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"kable","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"number-sections":true,"include-in-header":["_html/favicon.html"],"output-file":"dane.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","author":"Tomasz Golecki | Tomasz Hanusek | Damian Spodar","date":"12.12.2025","theme":{"light":"sandstone","dark":"flatly"},"fontsize":"16px","toc-title":"Spis treści","title-block-banner":"#947E76","title-block-banner-color":"#fcfffd","code-summary":"Pokaż/Ukryj Kod","title":"Wczesne Wykrywanie Ryzyka Zawału Serca","subtitle":"Zapoznanie I Praca Z Danymi","editor":"visual"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}